"use strict";(self.webpackChunkblockchain_wallet_v4_frontend=self.webpackChunkblockchain_wallet_v4_frontend||[]).push([[697],{"./src/modals/Transactions/DownloadTransactions/index.tsx":(e,t,n)=>{n.r(t),n.d(t,{default:()=>$});var a=n("../../node_modules/react/index.js"),o=n("../../node_modules/react-redux/es/index.js"),r=n("../../node_modules/browser-locale/index.js"),s=n.n(r),l=n("../../node_modules/moment/moment.js"),i=n("../../node_modules/ramda/es/prop.js"),c=n("../../node_modules/redux/es/redux.js"),d=n("./src/data/index.ts"),m=n("./src/data/types.ts"),u=n("./src/providers/ModalEnhancer/index.tsx"),p=n("../../node_modules/ramda/es/curry.js"),h=n("../../node_modules/ramda/es/assoc.js"),g=n("../../node_modules/ramda/es/map.js"),E=n("../../node_modules/reselect/es/index.js"),x=n("../blockchain-wallet-v4/src/types/index.ts"),f=n("../blockchain-wallet-v4/src/exchange/utils.ts"),w=["date","time","token","type","amount","value_then","value_now","exchange_rate_then","tx","note"],v=function formatTxData(e,t){return[e.date,e.time,t,e.type,e.amount||e.amount_btc||e.amount_bch,e.value_then,e.value_now,e.exchange_rate_then,e.hash||e.tx,e.description||e.note]},_=function formatHaskoinData(e,t,n){return[e.date,e.time,t,e.type,e.amount||e.amount_btc||e.amount_bch,(0,f.LE)({unit:n,value:e.value_then}),(0,f.LE)({unit:n,value:e.value_now}),(0,f.LE)({unit:n,value:e.exchange_rate_then}),e.hash||e.tx,e.description||e.note]};const y=(0,p.Z)(((e,t)=>t.map((t=>{const n=(0,i.Z)("tx",t),a=x.DD.selectNote(n,x.w5.selectTxNotes(e));return a?(0,h.Z)("note",a,t):t})))),Z=(0,p.Z)(((e,t)=>t.map((t=>{const n=(0,i.Z)("tx",t),a=e&&e[n];return a?(0,h.Z)("note",a,t):t})))),T=(0,E.P1)([(e,t)=>d.wl.vE.aT.eth.getErc20TransactionHistory(e,t),(e,t)=>t],((e,t)=>({csvData:e.map((e=>{const n=(0,g.Z)((e=>v(e,t)),e);return[w].concat(n)})).getOrElse([])}))),b=(0,E.P1)([d.wl.vE.aT.eth.getTransactionHistory],(e=>({csvData:e.map((e=>{const t=(0,g.Z)((e=>v(e,"ETH")),e);return[w].concat(t)})).getOrElse([])}))),D=(0,E.P1)([d.wl.vE.gU.getWallet,d.wl.vE.Xd.getCurrency,d.wl.vE.aT.btc.getTransactionHistory],((e,t,n)=>{const a=t.getOrElse("USD");return{csvData:n.map(y(e)).map((e=>{const t=(0,g.Z)((e=>_(e,"BTC",a)),e);return[w].concat(t)})).getOrElse([])}})),C=(0,E.P1)([d.wl.vE.Nu.iY.getBchTxNotes,d.wl.vE.Xd.getCurrency,d.wl.vE.aT.bch.getTransactionHistory],((e,t,n)=>{const a=t.getOrElse("USD");return{csvData:n.map(Z(e.getOrElse({}))).map((e=>{const t=(0,g.Z)((e=>_(e,"BCH",a)),e);return[w].concat(t)})).getOrElse([])}})),j=(0,E.P1)([d.wl.vE.aT.xlm.getTransactionHistory],(e=>({csvData:e.map((e=>{const t=(0,g.Z)((e=>v(e,"XLM")),e);return[w].concat(t)})).getOrElse([])}))),getData=(e,t)=>{switch(t){case"BTC":return D(e);case"BCH":return C(e);case"ETH":return b(e);case"XLM":return j(e);default:return T(e,t)}};var M=n("../../node_modules/react-csv/index.js"),H=n("./node_modules/react-intl/lib/src/components/message.js"),Y=n("../../node_modules/redux-form/es/Field.js"),k=n("../../node_modules/redux-form/es/reduxForm.js"),O=n("../../node_modules/styled-components/dist/styled-components.browser.esm.js"),P=n("../blockchain-info-components/src/index.js"),z=n("./src/components/Form/index.ts"),A=n("./src/services/forms/index.js");const F=O.ZP.div`
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  width: 100%;
  height: 100%;
`,N=O.ZP.div`
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  align-items: center;
  width: 100%;
  margin-bottom: 24px;
`,R=O.ZP.div`
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  align-items: center;
  width: 100%;
`,B=O.ZP.div`
  min-width: 18px;
`,L=(0,O.ZP)(P.xv)`
  margin-bottom: 6px;
`,S=(0,O.ZP)(L)`
  margin-right: 140px;
`,X=O.ZP.div`
  display: flex;
  flex-direction: row;
  justify-content: center;
  align-items: center;
  width: 100%;
  height: 45px;
`,U=(0,O.ZP)(M.CSVLink)`
  text-decoration: none;
  width: 100%;
`,validAddressOrWallet=e=>"all"!==e?void 0:a.createElement(H.Z,{id:"modals.transactions.report.required",defaultMessage:"Wallet selection required"}),V=(0,k.Z)({form:"transactionReport"})((e=>{const{closeAll:t,coin:n,csvData:o,filename:r,generating:s,handleSubmit:l,invalid:i,position:c,total:d}=e;return a.createElement(P.u_,{size:"medium",position:c,total:d},a.createElement(P.xB,{onClose:t},a.createElement(H.Z,{id:"modals.transactions.report.title",defaultMessage:"Download Transactions"})),a.createElement(P.fe,null,a.createElement(z.l0,{onSubmit:l},a.createElement(F,null,a.createElement(N,null,a.createElement(P.xv,{size:"14px",weight:500,capitalize:!0},a.createElement(H.Z,{id:"modals.transactions.report.wallet",defaultMessage:"Wallet"}))),a.createElement(N,null,"BCH"===n&&a.createElement(Y.Z,{coin:n,component:z.k2,includeAll:!1,name:"from",validate:[A.C1,validAddressOrWallet]}),"BTC"===n&&a.createElement(Y.Z,{coin:n,component:z.Qb,includeAll:!1,name:"from",validate:[A.C1,validAddressOrWallet]}),"ETH"===n&&a.createElement(Y.Z,{coin:n,component:z.Cr,name:"from",validate:[A.C1,validAddressOrWallet]}),"XLM"===n&&a.createElement(Y.Z,{coin:n,component:z.dc,name:"from",validate:[A.C1,validAddressOrWallet]}),window.coins[n].coinfig.type.erc20Address&&a.createElement(Y.Z,{coin:n,component:z.Cr,name:"from",validate:[A.C1,validAddressOrWallet]})),a.createElement(N,null,a.createElement(R,null,a.createElement(L,{size:"14px",weight:500,capitalize:!0},a.createElement(H.Z,{id:"modals.transactions.report.startdate",defaultMessage:"start date"})),a.createElement(S,{size:"14px",weight:500,capitalize:!0},a.createElement(H.Z,{id:"modals.transactions.report.enddate",defaultMessage:"end date"})))),a.createElement(N,null,a.createElement(R,null,a.createElement(Y.Z,{dateFormat:"MM/DD/YYYY",fullwidth:!0,name:"start",validate:[A.C1],component:z.ig}),a.createElement(B,null),a.createElement(Y.Z,{dateFormat:"MM/DD/YYYY",fullwidth:!0,name:"end",validate:[A.C1],component:z.ig})))),a.createElement(X,null,s?o.length>0?a.createElement(U,{data:o,filename:r,target:"_blank",onClick:t,width:"100%"},a.createElement(P.zx,{"data-e2e":"downloadReport",height:"45px",nature:"success",width:"100%"},a.createElement(H.Z,{id:"modals.transactions.report.download",defaultMessage:"Download Report"}))):a.createElement(P.zx,{"data-e2e":"loadingTransactionButton",disabled:!0,fullwidth:!0,height:"48px",nature:"primary"},a.createElement(P.JA,{height:"20px",width:"20px",color:"white"})):a.createElement(P.zx,{"data-e2e":"generateReport",disabled:s||i,height:"45px",nature:"primary",type:"submit",width:"100%"},a.createElement(H.Z,{id:"modals.transactions.report.generate",defaultMessage:"Generate Report"}))))))}));l.locale(s()());class W extends a.Component{constructor(e){super(e),this.onFetchHistory=()=>{const{coin:e,fetchTransactions:t,formValues:n}=this.props,a=(0,i.Z)("from",n),o=(0,i.Z)("start",n),r=(0,i.Z)("end",n),s=a.derivations&&a.derivations.map((e=>({address:e.xpub,type:e.type}))),l=a&&(s||a.xpub||a.address||a),c=`${e}_${o.format("MM-DD-YYYY")}_${r.format("MM-DD-YYYY")}.csv`;this.setState({filename:c,generating:!0}),t(l,o,r)},this.state={filename:"",generating:!1}}componentDidMount(){const{initForm:e}=this.props;e({end:l().endOf("day"),from:"all",start:l().startOf("day").subtract(7,"day")})}componentWillUnmount(){this.props.clearTransactions()}render(){const{onFetchHistory:e,props:t,state:n}=this,{filename:o,generating:r}=n,{closeAll:s,coin:l,csvData:i,position:c,total:d}=t;return a.createElement(V,{closeAll:s,coin:l,csvData:i,filename:o,generating:r,onSubmit:e,position:c,total:d})}}const $=(0,c.compose)((0,u.Z)(m.tl.TRANSACTION_REPORT_MODAL),(0,o.connect)(((e,t)=>Object.assign({formValues:d.wl.cr.getFormValues("transactionReport")(e)},getData(e,t.coin))),((e,{coin:t})=>{const{erc20Address:n,parentChain:a=t}=window.coins[t].coinfig.type,o=a.toLowerCase();return{clearTransactions:()=>e(d.Nw.vE.aT[o].clearTransactionHistory()),fetchTransactions:(a,r,s)=>e(n?d.Nw.vE.aT.eth.fetchErc20TransactionHistory(a,r,s,t):d.Nw.vE.aT[o].fetchTransactionHistory(a,r,s)),initForm:t=>e(d.Nw.cr.initialize("transactionReport",t))}})))(W)}}]);