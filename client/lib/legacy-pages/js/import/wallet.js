function precisionToSatoshiBN(e){return Bitcoin.Util.parseValue(e).divide(BigInteger.valueOf(Math.pow(10,sShift(symbol_btc)).toString()))}function precisionToBTC(e){return Bitcoin.Util.formatValue(precisionToSatoshiBN(e))}function precisionFromSatoshi(e){return Bitcoin.Util.formatValue(e.multiply(BigInteger.valueOf(Math.pow(10,sShift(symbol_btc)))))}function precisionFromBTC(e){return precisionFromSatoshi(Bitcoin.Util.parseValue(e))}function formatPrecision(e){return formatBTC(precisionToSatoshiBN(e).toString())}var MyWallet=new function(){var t,n,i,o,a,r,s,c=this;this.skip_init=!1;var l,d,u,f,p,h,g,m,v=0,y=0,b=0,w=0,k=0,_={},S=[],x=!1,T=0,P=0,C=1e3,A={},N=!0,B=5e3,W={},M=[],E=!1,I="en",K=0,V=!1,D=!1,L=!1,R=!1,O=!1,F=null,U=null,H={pbkdf2_iterations:5e3,fee_policy:0,html5_notifications:!1,logout_time:6e5,tx_display:0,always_keep_local_backup:!1,transactions_per_page:30,additional_seeds:[]};function hashPassword(e,t){for(var n=Crypto.SHA256(e,{asBytes:!0}),i=1;i<t;++i)n=Crypto.SHA256(n,{asBytes:!0});return Crypto.util.bytesToHex(n)}function hidePopovers(){try{$(".popover").remove()}catch(e){}}function bindTx(e,t){return e.click((function(){!function openTransactionSummaryModal(e,t){loadScript("wallet-legacy/frame-modal",(function(){showFrameModal({title:"Transaction Summary",description:"",src:root+"tx-summary/"+e+"?result="+t+"&symbol_btc="+symbol_btc.code+"&symbol_local="+symbol_local.code})}))}(t.txIndex,t.result)})),e.find(".show-note").unbind("mouseover").mouseover((function(){!function showNotePopover(e,t,n){!function(e,t,n){e=$(e);try{e.data("popover").tip().remove(),e.removeData("popover")}catch(e){}var i="Note";W[n]&&(i+=' <span style="float:right"><img src="'+resource+'delete.png" /></span>'),e.popover({title:i,trigger:"manual",content:t}),e.popover("show"),e.unbind("mouseleave").mouseleave((function(){e.__timeout||(e.__timeout=setTimeout((function(){e.popover("hide")}),250))}));var o=e.data("popover").tip().mouseenter((function(){e.__timeout&&(clearTimeout(e.__timeout),e.__timeout=null)}));o.find("img").unbind().click((function(){c.deleteNote(n)})),o.mouseleave((function(){e.__timeout=setTimeout((function(){e.popover("hide")}),250)}))}(e,t,n)}(this,t.note?t.note:W[t.hash],t.hash)})),e.find(".add-note").unbind("mouseover").mouseover((function(){!function addNotePopover(e,t){!function(e,t){e=$(e);try{e.data("popover").tip().remove(),e.removeData("popover")}catch(e){}function clearT(){e.__timeout&&(clearTimeout(e.__timeout),e.__timeout=null)}console.log("addNotePopover()"),e.popover({title:'Add Note <span style="float:right"><i class="icon-remove-sign"></i></span>',trigger:"manual",content:'<textarea style="width:97%;height:50px;margin-top:2px" placeholder="Enter the note here..."></textarea><div style="text-align:right"><button class="btn btn-small">Save</button></div>'}),e.popover("show"),e.unbind("mouseleave").mouseleave((function(){e.__timeout||(e.__timeout=setTimeout((function(){e.popover("hide")}),250))}));var n=e.data("popover").tip().mouseenter(clearT);n.find("textarea").focus(clearT),n.mouseleave((function(){e.__timeout=setTimeout((function(){e.popover("hide")}),250)})),n.find("i").unbind().click((function(){e.popover("hide")})),n.find("button").click((function(){var e=$.trim(n.find("textarea").val());isAlphaNumericSpace(e)?(e.length>0&&(W[t]=e,c.backupWalletDelayed()),buildVisibleView()):c.makeNotice("error","misc-error","Note must be contain letters and numbers only")}))}(e,t)}(this,t.hash)})),e}function calcTxResult(e,t){for(var n=0,i=0;i<e.inputs.length;++i){if((a=e.inputs[i].prev_out)&&a.addr)if(r=A[a.addr])n-=s=parseInt(a.value),t&&(y+=s,r.balance-=s)}for(var o=0;o<e.out.length;++o){var a,r,s;if((a=e.out[o])&&a.addr)if(r=A[a.addr])n+=s=parseInt(a.value),t&&(b+=s,r.balance+=s)}return n}function generatePayloadChecksum(){return Crypto.util.bytesToHex(Crypto.SHA256(t,{asBytes:!0}))}function wsSuccess(e){var t=null;e.onmessage=function(e){try{var n=$.parseJSON(e.data);if("on_change"==n.op){var i=generatePayloadChecksum(),o=n.checksum;console.log("On change old "+i+" ==  new "+o),t!=o&&i!=o&&(t=o,getWallet())}else if("utx"==n.op){var a=TransactionFromJSON(n.x);for(var r in S)if(S[r].txIndex==a.txIndex)return;var s=calcTxResult(a,!0);if(c.getHTML5Notifications()&&c.showNotification({title:s>0?"Payment Received":"Payment Sent",body:"Transaction Value "+formatBTC(s),iconUrl:resource+"cube48.png"}),a.result=s,v+=s,w++,a.setConfirmations(0),playSound("beep"),0==P&&0==T){S.unshift(a);var l=!1;S.length>c.getNTransactionsPerPage()&&(S.pop(),l=!0)}if(c.sendEvent("on_tx"),"my-transactions"==buildVisibleViewPre()){if(0==P&&0==T)if($("#no-transactions").hide(),0==H.tx_display){var d=$("#transactions-compact").show();bindTx(getCompactHTML(a,A,_),a).prependTo(d.find("tbody")).find("div").hide().slideDown("slow"),l&&d.find("tbody tr:last-child").remove()}else{(d=$("#transactions-detailed").show()).prepend(a.getHTML(A,_)),l&&d.find("div:last-child").remove(),setupSymbolToggle()}}else buildVisibleView()}else if("block"==n.op){for(var u=0;u<n.x.txIndexes.length;++u)for(var f=0;f<S.length;++f)if(S[f].txIndex==n.x.txIndexes[u]&&(null==S[f].blockHeight||0==S[f].blockHeight)){S[f].blockHeight=n.x.height;break}setLatestBlock(BlockFromJSON(n.x)),c.sendEvent("on_block"),buildTransactionsView()}}catch(e){console.log(e),console.log(e.data)}},e.onopen=function(){c.sendEvent("ws_on_open"),setLogoutImageStatus("ok");var t='{"op":"blocks_sub"}';null!=n&&(t+='{"op":"wallet_sub","guid":"'+n+'"}');try{var i=c.getActiveAddresses();for(var o in i)t+='{"op":"addr_sub", "addr":"'+i[o]+'"}'}catch(e){alert(e)}e.send(t)},e.onclose=function(){c.sendEvent("ws_on_close"),setLogoutImageStatus("error")}}this.setEncryptedWalletData=function(e){if(!e||0==e.length)return t=null,void(d=null);t=e,d=generatePayloadChecksum()},this.setRealAuthType=function(e){e},this.addAdditionalSeeds=function(e){H.additional_seeds.length>=50&&(H.additional_seeds=H.additional_seeds.slice(H.additional_seeds.length-49,H.additional_seeds.length)),H.additional_seeds.push(e)},this.getAdditionalSeeds=function(){return H.additional_seeds},this.getLanguage=function(){return I},this.setLanguage=function(e){MyStore.put("language",e),I=e},this.addEventListener=function(e){M.push(e)},this.sendEvent=function(e,t){for(var n in M)M[n](e,t)},this.getLogoutTime=function(){return H.logout_time},this.getSecondPasswordPbkdf2Iterations=function(){return H.pbkdf2_iterations},this.getMainPasswordPbkdf2Iterations=function(){return B},this.getSharedKey=function(){return s},this.getSharedcoinEndpoint=function(){return m},this.disableLogout=function(e){D=e},this.getFinalBalance=function(){return v},this.getTotalSent=function(){return y},this.getTotalReceived=function(){return b},this.setLogoutTime=function(e){H.logout_time=e,clearInterval(p),p=setTimeout(c.logout,c.getLogoutTime())},this.getDoubleEncryption=function(){return x},this.getEncryptedWalletData=function(){return t},this.getFeePolicy=function(){return H.fee_policy},this.setFeePolicy=function(e){H.fee_policy=parseInt(e)},this.setAlwaysKeepLocalBackup=function(e){H.always_keep_local_backup=e},this.getAlwaysKeepLocalBackup=function(){return H.always_keep_local_backup},this.setNTransactionsPerPage=function(e){H.transactions_per_page=e},this.getNTransactionsPerPage=function(){return H.transactions_per_page},this.getGuid=function(){return n},this.getHTML5Notifications=function(){return H.html5_notifications},this.setHTML5Notifications=function(e){H.html5_notifications=e},this.getNTransactions=function(){return w},this.getTransactions=function(){return S},this.addressExists=function(e){return null!=A[e]},this.getAddressTag=function(e){return A[e].tag},this.setAddressTag=function(e,t){A[e].tag=t},this.getAddressBook=function(){return _},this.getAddressLabel=function(e){return A[e]?A[e].label:null},this.setAddressLabel=function(e,t){A[e].label=t},this.setAddressBalance=function(e,t){A[e].balance=t},this.getAddressBookLabel=function(e){return _[e]},this.isWatchOnly=function(e){return!A[e]||null==A[e].priv},this.getAddressBalance=function(e){return A[e].balance},this.getRecommendIncludeFee=function(){return N},this.deleteAddress=function(e){delete A[e]},this.addAddressBookEntry=function(e,t){_[e]=t},this.getPrivateKey=function(e){return A[e].priv},this.setLabel=function(e,t){A[e].label=t,c.backupWalletDelayed(),buildVisibleView()},this.securePost=function(e,t,i,o){var a=jQuery.extend({},t);if(!t.sharedKey){if(!s||0==s.length||36!=s.length)throw"Shared key is invalid";var r=(new Date).getTime(),c=parseInt((r-K)/1e4),l=Crypto.SHA256(s.toLowerCase()+c),d=0,u=l.substring(d,d+=8)+"-"+l.substring(d,d+=4)+"-"+l.substring(d,d+=4)+"-"+l.substring(d,d+=4)+"-"+l.substring(d,d+=12);a.sharedKey=u,a.sKTimestamp=c,a.sKDebugHexHash=l,a.sKDebugTimeOffset=K,a.sKDebugOriginalClientTime=r,a.sKDebugOriginalSharedKey=s}t.guid||(a.guid=n),a.format=t.format?t.format:"plain";var f="text";"json"==t.format&&(f="json"),$.ajax({dataType:f,type:"POST",timeout:6e4,url:root+e,data:a,success:i,error:o})},this.isCorrectMainPassword=function(e){return o==e},this.setPbkdf2Iterations=function(t,n){var panic=function(e){console.log("Panic "+e),window.location.reload()};c.getSecondPassword((function(){try{if(x){for(var i in A){var o=A[i];if(o.priv&&(o.priv=c.encrypt(c.decryptPK(o.priv),s+a,t),!o.priv))throw"addr.priv is null"}H.pbkdf2_iterations=t,r=hashPassword(s+a,t)}2,B=t,c.backupWallet("update",(function(){n()}),(function(){panic(e)}))}catch(e){panic(e)}}),(function(e){panic(e)}))},this.setDoubleEncryption=function(t,n,i){var panic=function(e){console.log("Panic "+e),window.location.reload()};try{if(x==t)return;t?c.getSecondPassword((function(){try{for(var t in x=!0,a=n,A){var o=A[t];if(o.priv&&(o.priv=encodePK(B58.decode(o.priv)),!o.priv))throw"addr.priv is null"}r=hashPassword(s+a,H.pbkdf2_iterations),a=null,c.getSecondPassword((function(){try{c.checkAllKeys(),c.backupWallet("update",(function(){i()}),(function(){panic(e)}))}catch(e){panic(e)}}),(function(e){panic(e)}))}catch(e){panic(e)}}),(function(e){panic(e)})):c.getSecondPassword((function(){try{for(var t in A){var n=A[t];if(n.priv&&(n.priv=c.decryptPK(n.priv),!n.priv))throw"addr.priv is null"}x=!1,a=null,c.checkAllKeys(),c.backupWallet("update",(function(){i()}),(function(){panic(e)}))}catch(e){panic(e)}}),(function(e){panic(e)}))}catch(e){panic(e)}},this.unArchiveAddr=function(e){2==(e=A[e]).tag?(e.tag=null,buildVisibleView(),c.backupWalletDelayed("update",(function(){c.get_history()}))):c.makeNotice("error","add-error","Cannot Unarchive This Address")},this.archiveAddr=function(e){c.getActiveAddresses().length<=1?c.makeNotice("error","add-error","You must leave at least one active address"):null==(e=A[e]).tag||0==e.tag?(e.tag=2,buildVisibleView(),c.backupWalletDelayed("update",(function(){c.get_history()}))):c.makeNotice("error","add-error","Cannot Archive This Address")},this.addWatchOnlyAddress=function(e){return internalAddKey(e)},this.addPrivateKey=function(e,t){if(function walletIsFull(){if(nKeys(A)>=C)return c.makeNotice("error","misc-error","We currently support a maximum of 1000 private keys, please remove some unused ones."),!0;return!1}())return!1;if(null==e)throw"Cannot add null key.";null==t&&(t={});var n=t.compressed?e.getBitcoinAddressCompressed().toString():e.getBitcoinAddress().toString(),i=encodePK(e.priv);if(null==i)throw"Error Encoding key";var o=new Bitcoin.ECKey(c.decodePK(i));if(n!=o.getBitcoinAddress().toString()&&n!=o.getBitcoinAddressCompressed().toString())throw"Decoded Key address does not match generated address";if(!internalAddKey(n,i))throw"Unable to add generated private key.";if(A[n].tag=1,A[n].created_time=t.created_time?t.created_time:(new Date).getTime(),A[n].created_device_name=t.app_name?t.app_name:APP_NAME,A[n].created_device_version=t.app_version?t.app_version:APP_VERSION,A[n].priv!=i)throw"Address priv does not match encoded";try{ws.send('{"op":"addr_sub", "addr":"'+n+'"}')}catch(e){}return n},this._seed=function(e){var t=""+(new Date).getTime();o&&o.length>0&&(t+=o),e&&e.length>0&&(t+=e),g&&g.length>0&&(t+=g);var n=$("body").data("extra-seed");n&&n.length>0&&(t+=n);for(var i=[],a=0;i.length<rng_psize;)i=i.concat(Crypto.SHA256(t+a,{asBytes:!0})),++a;var r=Crypto.util.bytesToWords(i);seed_large_int32_array(r)},this.generateNewKey=function(e){c._seed(e);var t=new Bitcoin.ECKey(!1),n=c.addPrivateKey(t,{compressed:!0});if(n)return{key:t,addr:n}},this.setLoadingText=function(e){$(".loading-text").text(e)},$(window).resize((function(){$(".modal:visible").center(),hidePopovers()}));var j="ok";function setLogoutImageStatus(e){var t=$("#logout");"loading_start"!=e?("loading_stop"!=e&&(j=e),"ok"==j?t.attr("src",resource+"logout.png"):"error"==j&&t.attr("src",resource+"logout-red.png")):t.attr("src",resource+"logout-orange.png")}function noConvert(e){return e}function base58ToBase58(e){return c.decryptPK(e)}function base58ToBase64(e){var t=c.decodePK(e);return Crypto.util.bytesToBase64(t)}function base58ToHex(e){var t=c.decodePK(e);return Crypto.util.bytesToHex(t)}function buildSelect(e,t,n){var i=e.val();for(var o in e.empty(),A){var a=A[o];if(a&&2!=a.tag){var r=a.label;r||(r=a.addr.substring(0,15)+"..."),(t||a.balance>0)&&e.prepend('<option value="'+a.addr+'">'+r+" - "+formatBTC(a.balance)+"</option>")}}e.prepend('<option value="any" selected>Any Address</option>'),!n&&i&&e.val(i)}function buildSendForm(e,t){buildSelect(e.find('select[name="from"]'),!1,t),buildSelect(e.find('select[name="change"]'),!0,t),e.find('select[name="change"]').prepend('<option value="new">New Address</option>'),e.find(".local-symbol").text(symbol_local.symbol),e.find(".btc-symbol").text(symbol_btc.symbol),t&&(e.find("input").val(""),e.find(".send-value-usd").text(formatSymbol(0,symbol_local)).val(""),e.find(".amount-needed").text(0));var n=e.find(".recipient-container");if(t){var i=n.find(".recipient:first-child").clone();n.empty().append(i)}function bindRecipient(t){t.find('input[name="send-to-address"]').typeahead({source:getActiveLabels()}).next().unbind().click((function(){var e=$(this).prev();c.scanQRCode((function(n){console.log(n);try{new Bitcoin.Address(n),e.val(n)}catch(e){c.handleURI(n,t)}}),(function(e){c.makeNotice("error","misc-error",e)}))})),t.find(".send-value").unbind().bind("keyup change",(function(n){"9"!=n.keyCode&&(e.find(".amount-needed").text(formatBTC(function totalValueBN(){var t=BigInteger.ZERO;return e.find(".send-value").each((function(){t=t.add(precisionToSatoshiBN($(this).val()))})),t}().toString())),t.find(".send-value-usd").val(convert($(this).val()*symbol_btc.conversion,symbol_local.conversion)).text(formatSymbol($(this).val()*symbol_btc.conversion,symbol_local)))})),t.find(".send-value-usd").text(formatSymbol(0,symbol_local)).unbind().bind("keyup change",(function(e){"9"!=e.keyCode&&t.find(".send-value").val(formatSatoshi(parseFloat($(this).val())*symbol_local.conversion,sShift(symbol_btc),!0))}))}n.find(".recipient").each((function(){bindRecipient($(this))})),e.find(".remove-recipient").unbind().click((function(){var e=n.find(".recipient").length;e>1&&(2==e&&$(this).hide(200),n.find(".recipient:last-child").remove())})),e.find(".add-recipient").unbind().click((function(){var t=n.find(".recipient:first-child").clone();t.find('input[type="text"]').val(""),t.appendTo(n),bindRecipient(t),e.find(".remove-recipient").show(200)}));var o=e.find('select[name="from"]');0==o.length?e.find(".amount-available").text(formatBTC(v)):o.unbind().change((function(){var t=0,n=$(this).val();for(var i in n){if("any"==n[i]){$(this).val("any"),t=v;break}var o=A[n[i]];o&&o.balance&&(t+=o.balance)}e.find(".amount-available").text(formatBTC(t))})).trigger("change")}function setLatestBlock(e){if(null!=e){for(var t in l=e,S){var n=S[t];if(null!=n.blockHeight&&n.blockHeight>0)l.height-n.blockHeight+1<=100?n.setConfirmations(l.height-n.blockHeight+1):n.setConfirmations(null);else n.setConfirmations(0)}c.sendEvent("did_set_latest_block")}}function isAlphaNumericSpace(e){return/^[\w\-,._  @\+]+$/.test(e)}function getCompactHTML(e,t,n){var i=e.result,o=$('<tr class="pointer"></tr>');o.attr("id","tx-"+e.txIndex);var a=$('<td class="hidden-phone" style="width:365px"></td>');o.append(a);var r=$('<div style="margin-left:0px;margin-bottom:9px;" class="short-addr"></div>');a.append(r);var s=!0;if(i>=0)if(e.inputs.length>5)s=!1,r.append('<span class="label">Many Inputs</span>');else for(var c=0;c<e.inputs.length;++c){if(l=e.inputs[c].prev_out)if(l.addr){if(t[l.addr])continue;s=!1,r.append(formatOutput(l,t,n))}else s=!1,r.append('<span class="label">Unknown Address</span>');else{if(s=!1,1==e.inputs.length){r.append('<span class="label">Newly Generated Coins</span>');break}r.append('<span class="label">Missing Outpoint</span>')}}else if(i<0)if(e.out.length>5)s=!1,r.append('<span class="label">Many Outputs</span>');else for(c=0;c<e.out.length;++c){var l;if((l=e.out[c]).addr){if(t[l.addr]&&0==l.type)continue;s=!1,r.append(formatOutput(l,t,n))}else s=!1,r.append('<span class="label">Unknown Address</span>')}s&&r.append('<span class="label">Moved Between Wallet</info>');a=$("<td></td>");o.append(a);r=$("<div></div>");if(a.append(r),(e.note?e.note:W[e.hash])?r.append('<img src="'+resource+'note.png" class="show-note"> '):r.append('<img src="'+resource+'note_grey.png" class="add-note"> '),e.time>0&&r.append(dateToString(new Date(1e3*e.time))+" "),0==e.confirmations||e.confirmations>0){var d=$('<span class="label hidden-phone"></span>');0==e.confirmations?(d.addClass("label-important"),d.text("Unconfirmed Transaction!")):e.confirmations>0&&(d.addClass("label-info"),d.text(e.confirmations+" Confirmations")),r.append(d)}a=$("<td>"+formatMoney(i,!0)+"</td>");o.append(a),i>0?a.css({color:"green"}):i<0&&a.css({color:"red"});a=$('<td class="hidden-phone"></td>');return o.append(a),null!=e.balance&&a.append("<div>"+formatMoney(e.balance)+"</div>"),o}function buildVisibleViewPre(){return hidePopovers(),null==v?$("#balance").html("Loading..."):($("#balance").html(formatSymbol(v,symbol,!0)),$("#balance2").html(formatSymbol(v,symbol===symbol_local?symbol_btc:symbol_local),!0)),i.attr("id")}function buildVisibleView(e){var t=buildVisibleViewPre();"send-coins"==t?function buildSendTxView(e){$("#send-coins").find(".tab-pane.active").trigger("show",e),e&&(BlockchainAPI.get_ticker(),$(".send").prop("disabled",!1))}(e):"home-intro"==t?function buildHomeIntroView(e){$("#summary-n-tx").html(w),$("#summary-received").html(formatMoney(b,!0)),$("#summary-sent").html(formatMoney(y,!0)),$("#summary-balance").html(formatMoney(v,symbol)),$(".paper-wallet-btn").unbind().click((function(){loadScript("wallet-legacy/paper-wallet",(function(){PaperWallet.showModal()}))}));var t=c.getPreferredAddress();if(null==t)return;if(c.isWatchOnly(t))$(".no-watch-only").hide();else{$(".no-watch-only").show();var n=$("#my-primary-address");n.text()!=t&&(n.text(t),loadScript("wallet-legacy/jquery.qrcode",(function(){$("#my-primary-addres-qr-code").empty().qrcode({width:125,height:125,text:t})})))}$("#tweet-for-btc").unbind().click((function(){c.openWindow("https://twitter.com/share?url=https://blockchain.info/wallet&hashtags=tweet4btc,bitcoin,"+t+"&text=Sign Up For a Free Bitcoin Wallet @ Blockchain.info")}))}():"receive-coins"==t?function buildReceiveCoinsView(){$("#receive-coins").find(".tab-pane.active").trigger("show"),setupToggle()}():"my-transactions"==t&&buildTransactionsView()}function buildTransactionsView(){var e,t=null,n=0;if(null!=t&&(clearInterval(t),t=null),0==H.tx_display?($("#transactions-detailed").hide(),e=$("#transactions-compact").show().find("tbody").empty()):($("#transactions-compact").hide(),e=$("#transactions-detailed").empty().show()),0==S.length)return $("#transactions-detailed, #transactions-compact").hide(),void $("#no-transactions").show();$("#no-transactions").hide();var buildSome=function(){for(var i=n;i<S.length&&i<n+c.getNTransactionsPerPage();++i){var o=S[i];0==H.tx_display?e.append(bindTx(getCompactHTML(o,A,_),o)):e.append(o.getHTML(A,_))}if((n+=c.getNTransactionsPerPage())<S.length)t=setTimeout(buildSome,15);else{setupSymbolToggle(),hidePopovers();var a=$(".pagination ul").empty();if(0==T&&S.length<c.getNTransactionsPerPage())return void a.hide();a.show();var r=Math.ceil(k/c.getNTransactionsPerPage()),s=" disabled";T>0&&(s="");var l=Math.max(0,Math.min(T-5,r-10));a.append($('<li class="prev'+s+'"><a>&larr; Previous</a></li>').click((function(){c.setPage(T-1)}))),l>0&&a.append($("<li><a>≤</a></li>").click((function(){c.setPage(0)})));for(i=l;i<r&&i<l+10;++i)!function(e){var t="";T==e&&(t=' class="active"'),a.append($("<li"+t+'><a class="hidden-phone">'+(e+1)+"</a></li>").click((function(){c.setPage(e)})))}(i);l+10<r&&a.append($("<li><a>≥</a></li>").click((function(){c.setPage(r-1)})));s=" disabled";T<r-1&&(s=""),a.append($('<li class="next'+s+'"><a>Next &rarr;</a></li>').click((function(){c.setPage(T+1)})))}};buildSome()}function parseMultiAddressJSON(e,t){if(t||(N=e.recommend_include_fee,e.info&&(e.info.symbol_local&&setLocalSymbol(e.info.symbol_local),e.info.symbol_btc&&setBTCSymbol(e.info.symbol_btc),e.info.notice&&c.makeNotice("error","misc-error",e.info.notice))),m=e.sharedcoin_endpoint,S.length=0,null==e.wallet)return b=0,y=0,v=0,w=0,void(k=0);b=e.wallet.total_received,y=e.wallet.total_sent,v=e.wallet.final_balance,w=e.wallet.n_tx,k=e.wallet.n_tx_filtered;for(var n=0;n<e.addresses.length;++n)A[e.addresses[n].address]&&(A[e.addresses[n].address].balance=e.addresses[n].final_balance);for(n=0;n<e.txs.length;++n){var i=TransactionFromJSON(e.txs[n]);i.result=calcTxResult(i,!1),S.push(i)}t||e.info.latest_block&&setLatestBlock(e.info.latest_block),c.sendEvent("did_multiaddr")}function didDecryptWallet(){getWallet(),p=setTimeout(c.logout,c.getLogoutTime()),c.sendEvent("did_decrypt"),c.get_history(null,(function(){MyStore.get("multiaddr",(function(e){null!=e&&(parseMultiAddressJSON($.parseJSON(e),!0),buildVisibleView())}))})),$("#initial_error,#initial_success").remove();var e=decodeURIComponent(window.location.hash.replace("#",""));if(0==e.indexOf("bitcoin:")){var t=$("#send-coins");changeView(t);var n=t.find(".tab-pane.active").find(".recipient").first();c.handleURI(e,n)}else changeView($("#home-intro"));window.location.hash=""}function getWallet(e,t){var n={method:"wallet.aes.json",format:"json"};d&&d.length>0&&(n.checksum=d),c.setLoadingText("Checking For Wallet Updates"),c.securePost("wallet",n,(function(n){if(n.storage_token&&(null!=U&&-1!=U.indexOf(n.storage_token)||MyStore.put("storage_token",(U?U+"|":"")+n.storage_token)),n.payload&&"Not modified"!=n.payload){var i;try{i=$.parseJSON(n.payload)}catch(e){}if(i&&i.version&&i.version>=3){var o=c.getGuid();return null==o&&(o=""),void(window.location=root+"wallet/#/login/"+o)}c.setEncryptedWalletData(n.payload),internalRestoreWallet((function(){c.get_history(),buildVisibleView(),e&&e()}),(function(){t&&t()}))}else e&&e()}),(function(e){t&&t()}))}function internalRestoreWallet(e,n){null!=t&&0!=t.length?c.decryptWallet(t,o,(function(t,i){try{if(!(s=t.sharedKey)||0==s.length||36!=s.length)throw"Shared Key is invalid";i&&(i.version,B=i.pbkdf2_iterations),t.double_encryption&&t.dpasswordhash&&(x=t.double_encryption,r=t.dpasswordhash),t.options&&($.extend(H,t.options),H.additional_seeds.length>=50&&(H.additional_seeds=H.additional_seeds.slice(H.additional_seeds.length-50,H.additional_seeds.length))),A={};for(var o=0;o<t.keys.length;++o){var a=t.keys[o];a.addr&&isAlphaNumericSpace(a.addr)?(1!=a.tag&&isAlphaNumericSpace(a.tag)||(a.tag=null),a.label&&!isAlphaNumericSpace(a.label)&&(a.label=null),A[a.addr]=a):c.makeNotice("error","null-error","Your wallet contains an invalid address. This is a sign of possible corruption, please double check all your BTC is accounted for. Backup your wallet to remove this error.",15e3)}if(_={},t.address_book)for(o=0;o<t.address_book.length;++o){var l=t.address_book[o];l.label&&isAlphaNumericSpace(l.label)&&isAlphaNumericSpace(l.addr)&&c.addAddressBookEntry(l.addr,l.label)}if(t.hd_wallets&&(F=t.hd_wallets),t.tx_notes)for(var u in t.tx_notes){var f=t.tx_notes[u];f&&isAlphaNumericSpace(f)&&(W[u]=f)}null!=d&&0!=d.length||(d=generatePayloadChecksum()),function setIsInitialized(){if(E)return;setLogoutImageStatus("error"),webSocketConnect(wsSuccess),E=!0,$("#tech-faq").hide(),$("#intro-text").hide(),$("#large-summary").show()}(),e()}catch(e){n(e)}}),n):n("No Wallet Data To Decrypt")}function encodePK(e){return function encryptPK(e){if(x){if(null==a)throw"Cannot encrypt private key without a password";return c.encrypt(e,s+a,c.getSecondPasswordPbkdf2Iterations())}return e}(B58.encode(e))}function changeView(e){e!==i&&(null!=i&&($("#"+i.attr("id")+"-btn").length>0&&$("#"+i.attr("id")+"-btn").parent().attr("class",""),i.hide()),(i=e).show(),$("#"+i.attr("id")+"-btn").length>0&&$("#"+i.attr("id")+"-btn").parent().attr("class","active"),buildVisibleView(!0))}function nKeys(e){var t,n=0;for(t in e)n++;return n}function internalAddKey(e,t){var n=A[e];return n&&0!=n.length?!(n.priv||!t)&&(n.priv=t,!0):(A[e]={addr:e,priv:t,balance:0},!0)}function getActiveLabels(){var e=[];for(var t in _)e.push(_[t]);for(var t in A){var n=A[t];2!=n.tag&&n.label&&e.push(n.label)}return e}function buildPopovers(){try{$(".pop").popover({offset:10,placement:"bottom"})}catch(e){}}function bindReady(){L||(L=!0,$("#add-address-book-entry-btn").click((function(){!function addAddressBookModal(){var e=$("#add-address-book-entry-modal");e.modal({keyboard:!0,backdrop:"static",show:!0});var t=e.find('input[name="label"]'),n=e.find('input[name="address"]');t.val(""),n.val(""),e.find(".btn.btn-primary").unbind().click((function(){e.modal("hide");var i=$.trim(t.val()),o=$.trim(n.val());if(0==i.length||0==o.length)return c.makeNotice("error","misc-error","You must enter an address and label for the address book entry"),!1;if(!isAlphaNumericSpace(i)||!isAlphaNumericSpace(o))return c.makeNotice("error","misc-error","Label and Bitcoin Address must contain letters and numbers only"),!1;try{if(null==new Bitcoin.Address(o))throw"Null address"}catch(e){return c.makeNotice("error","misc-error","Bitcoin address invalid, please make sure you entered it correctly"),!1}if(null!=_[o])return c.makeNotice("error","misc-error","Bitcoin address already exists"),!1;c.makeNotice("success","misc-success","Added Address book entry"),c.addAddressBookEntry(o,i),c.backupWalletDelayed(),$("#send-coins").find(".tab-pane").trigger("show",!0)})),e.find(".btn.btn-secondary").unbind().click((function(){e.modal("hide")}))}()})),$("#home-intro-btn").click((function(){changeView($("#home-intro"))})),$("#my-transactions-btn").click((function(){changeView($("#my-transactions"))})),$("#send-coins-btn").click((function(){changeView($("#send-coins"))})),$("#import-export-btn").click((function(){changeView($("#import-export")),function buildImportExportView(){var e=$("#export-warning").show(),t=$("#import-export-content").hide();$("#show-import-export").unbind().click((function(){c.getMainPassword((function(){e.hide(),loadScript("wallet-legacy/import-export",(function(){ImportExport.init(t,(function(){t.show()}),(function(){changeView($("#home-intro"))}))}),(function(e){c.makeNotice("error","misc-error",e),changeView($("#home-intro"))}))}),(function(){changeView($("#home-intro"))}))}))}()})),$("#chord-diagram").click((function(){loadScript("wallet-legacy/frame-modal",(function(){showFrameModal({title:"Address Relationships",description:"",src:root+"taint/"+c.getActiveAddresses().join("|")})}))})),$("#verify-message").click((function(){loadScript("wallet-legacy/address_modal",(function(){verifyMessageModal()}))})),$("#generate-cold-storage").click((function(){loadScript("wallet-legacy/paper-wallet",(function(){PaperWallet.showColdStorageModal()}),null,!0)})),$("#group-received").click((function(){loadScript("wallet-legacy/taint_grouping",(function(){try{loadTaintData()}catch(e){c.makeNotice("error","misc-error","Unable To Load Taint Grouping Data")}}))})),$("#my-account-btn").click((function(){changeView($("#my-account"));var e=$("#account-settings-warning").show(),t=$("#my-account-content").hide();$("#show-account-settings").unbind().click((function(){c.getMainPassword((function(){e.hide(),loadScript("wallet-legacy/account",(function(){AccountSettings.init(t,(function(){t.show()}),(function(){changeView($("#home-intro"))}))}),(function(e){c.makeNotice("error","misc-error",e),changeView($("#home-intro"))}))}),(function(){changeView($("#home-intro"))}))}))})),$("#active-addresses").on("show",(function(){var e=$(this).find("table:first");e.find("tbody:gt(0)").remove();e.find("tbody").empty();for(var t in A){var n=A[t];if(2!=n.tag&&1!=n.tag){var i="";1==n.tag?i=' <font color="red" class="pop" title="Not Synced" data-content="This is a new address which has not yet been synced with our the server. Do not used this address yet.">(Not Synced)</font>':null==n.priv&&(i=' <font color="red" class="pop" title="Watch Only" data-content="Watch Only means there is no private key associated with this bitcoin address. <br /><br /> Unless you have the private key stored elsewhere you do not own the funds at this address and can only observe the transactions.">(Watch Only)</font>');var o="",a=n.addr;null!=n.label&&(a=n.label,o='<span class="hidden-phone"> - '+n.addr+"</span>");var r=$('<tr><td><div class="short-addr"><a href="'+root+"address/"+n.addr+'" target="new">'+a+"</a>"+o+" "+i+'<div></td><td><span style="color:green">'+formatMoney(n.balance,!0)+'</span></td>            <td><div class="btn-group pull-right"><a class="btn btn-mini dropdown-toggle" data-toggle="dropdown" href="#"><span class="hidden-phone">Actions </span><span class="caret"></span></a><ul class="dropdown-menu">             <li><a href="#" class="pop act-archive" title="Archive Address" data-content="Click this button to hide the address from the main view. You can restore or delete later by finding it in the Archived addresses tab.">Archive Address</a></li>            <li><a href="#" class="pop act-label" title="Label Address" data-content="Set the label for this address.">Label Address</a></li>            <li><a href="#" class="pop act-qr" title="Show QR Code" data-content="Show a QR Code for this address.">QR Code</a></li>            <li><a href="#" class="pop act-sign" title="Sign Message" data-content="Sign A message with this address.">Sign Message</a></li>            <li><a href="#" class="pop act-request" title="Request Payment" data-content="Click here to create a new QR Code payment request. The QR Code can be scanned using most popular bitcoin software and mobile apps.">Create Payment Request</a></li>            <li><a href="#" class="pop act-pubkey">Show Public Key</a></li>            </ul></div></td></tr>');!function(e){r.find(".act-archive").click((function(){c.archiveAddr(e)})),r.find(".act-label").click((function(){loadScript("wallet-legacy/address_modal",(function(){showLabelAddressModal(e)}))})),r.find(".act-qr").click((function(){loadScript("wallet-legacy/address_modal",(function(){showAddressModalQRCode(e)}))})),r.find(".act-pubkey").click((function(){c.getSecondPassword((function(){var t=c.getPrivateKey(e);if(null!=t){var n=new Bitcoin.ECKey(c.decodePK(t));if(n.getBitcoinAddressCompressed().toString()==e)var i=n.getPubCompressed();else i=n.getPub();c.makeNotice("success","pub-key","Public Key of "+e+" is "+Crypto.util.bytesToHex(i),2e4)}else c.makeNotice("eror","misc-error","Public Key Unknown")}))})),r.find(".act-sign").click((function(){loadScript("wallet-legacy/address_modal",(function(){showAddressModalSignMessage(e)}))})),r.find(".act-request").click((function(){loadScript("wallet-legacy/frame-modal",(function(){showFrameModal({title:"Create Payment Request",description:"Request Payment into address <b>"+e+"</b>",src:root+"payment_request?address="+e})}))}))}(n.addr),n.balance>0&&n.priv?e.prepend(r):e.append(r)}}buildPopovers()})),$("#archived-addresses").on("show",(function(){$("#archived-addr tbody").empty();var e=$(this).find("tbody"),t=c.getArchivedAddresses(),build=function(){for(var n in e.empty(),t){var i=A[t[n]];if(2==i.tag&&1!=i.tag){var o="";null==i.priv&&(o=' <font color="red">(Watch Only)</font>');var a="",r=i.addr;null!=i.label&&(r=i.label,a='<span class="hidden-phone"> - '+i.addr+"</span>");var s=$('<tr><td style="width:20px;"><input type="checkbox" class="archived_checkbox" value="'+i.addr+'"></td><td><div class="short-addr"><a href="'+root+"address/"+i.addr+'" target="new">'+r+"</a>"+a+" "+o+'<div></td><td><span style="color:green">'+formatBTC(i.balance)+'</span></td><td style="width:16px"><img src="'+resource+'unarchive.png" class="act-unarchive" /></td></tr>');!function(e){s.find(".act-unarchive").click((function(){c.unArchiveAddr(e)}))}(i.addr),i.balance>0&&i.priv?e.prepend(s):e.append(s)}}};build(),BlockchainAPI.get_balances(t,(function(e){build()}),(function(e){c.makeNotice("error","misc-error",e)}))})),$("#archived-select-all").click((function(){$(".archived_checkbox").prop("checked",!0)})),$("#archived-select-none").click((function(){$(".archived_checkbox").prop("checked",!1)})),$("#archived-sweep").click((function(){var e=[];$(".archived_checkbox:checked").each((function(){var t=A[$(this).val()];null!=t.priv?e.push(t.addr):c.makeNotice("error","misc-error","Cannot Sweep Watch Only Address")})),0!=e.length&&c.sweepAddressesModal(e)})),$("#archived-delete").click((function(){var e=[];$(".archived_checkbox:checked").each((function(){e.push($(this).val())})),0!=e.length&&function deleteAddresses(e){var t=$("#delete-address-modal");t.modal({keyboard:!0,backdrop:"static",show:!0}),t.find(".btn.btn-primary").hide(),t.find(".btn.btn-danger").hide(),$("#change-mind").hide(),t.find("#to-delete-address").html(e.join(" ")),t.find("#delete-balance").empty();var n=t.find("#delete-balance"),i=[];for(var o in e){var a=e[o];A[a]&&A[a].priv&&i.push(e[o])}BlockchainAPI.get_balance(i,(function(e){t.find(".btn.btn-primary").show(200),t.find(".btn.btn-danger").show(200),n.html("Balance "+formatBTC(e)),e>0?n.css("color","red"):n.css("color","black")}),(function(){t.find(".btn.btn-primary").show(200),t.find(".btn.btn-danger").show(200),n.text("Error Fetching Balance")}));var r=!1,s=(o=0,null);changeMind=function(){$("#change-mind").show(),$("#change-mind-time").text(10-o)},t.find(".btn.btn-primary").unbind().click((function(){changeMind(),t.find(".btn.btn-primary").hide(),t.find(".btn.btn-danger").hide(),s=setInterval((function(){var t;if(!r&&(++o,changeMind(),10==o)){for(var n in $("#delete-address-modal").modal("hide"),c.makeNotice("warning","warning-deleted","Private Key Removed From Wallet"),e)t=e[n],A[t].priv=null;buildVisibleView(),c.backupWallet(),clearInterval(s)}}),1e3)})),t.find(".btn.btn-danger").unbind().click((function(){changeMind(),t.find(".btn.btn-primary").hide(),t.find(".btn.btn-danger").hide(),s=setInterval((function(){if(!r&&(++o,changeMind(),10==o))try{for(var t in $("#delete-address-modal").modal("hide"),c.makeNotice("warning","warning-deleted","Address & Private Key Removed From Wallet"),e)c.deleteAddress(e[t]);buildVisibleView(),c.backupWallet("update",(function(){c.get_history()}))}finally{clearInterval(s)}}),1e3)})),t.unbind().on("hidden",(function(){s&&(r=!0,clearInterval(s),s=null)})),t.find(".btn.btn-secondary").unbind().click((function(){t.modal("hide")}))}(e)})),$("#shared-never-ask").click((function(){SetCookie("shared-never-ask",$(this).is(":checked"))})),$(".deposit-btn").click((function(){var e=$(this),t=c.getPreferredAddress(),i=e.data("extra");null==i&&(i=""),loadScript("wallet-legacy/frame-modal",(function(){showFrameModal({title:e.data("title"),description:"Deposit into address <b>"+t+"</b>",top_right:'Have Questions? Read <a href="'+e.data("link")+'" target="new">How It Works</a>',src:root+"deposit?address="+t+"&ptype="+e.data("type")+"&guid="+n+i})}))})),$(".withdraw-btn").click((function(){var e=$(this);c.getSecondPassword((function(){var t=c.getPreferredAddress();loadScript("wallet-legacy/frame-modal",(function(){showFrameModal({title:e.data("title"),description:"Your Wallet Balance is <b>"+formatBTC(v)+"</b>",src:root+"withdraw?method="+e.data("type")+"&address="+t+"&balance="+v+"&guid="+n})}))}))})),$("#logout").click(c.logout),$("#refresh").click((function(){getWallet((function(){c.get_history()}))})),$("#summary-n-tx-chart").click((function(){loadScript("wallet-legacy/frame-modal",(function(){showFrameModal({title:"Number of transactions",description:"",src:root+"charts/n-transactions?show_header=false&address="+c.getActiveAddresses().join("|")})}))})),$("#summary-received-chart").click((function(){loadScript("wallet-legacy/frame-modal",(function(){showFrameModal({title:"BTC Received Per Day",description:"",src:root+"charts/received-per-day?show_header=false&address="+c.getActiveAddresses().join("|")})}))})),$("#summary-balance-chart").click((function(){loadScript("wallet-legacy/frame-modal",(function(){showFrameModal({title:"Wallet Balance",description:"",src:root+"charts/balance?show_header=false&address="+c.getActiveAddresses().join("|")})}))})),$("#new-addr").click((function(){$("#new-addr").prop("disabled",!0),getWallet((function(){c.getSecondPassword((function(){var e=c.generateNewKey();if(!e||!e.addr)throw $("#new-addr").removeAttr("disabled"),"Error Generating New Address";var t=e.addr;c.backupWallet("update",(function(){c.makeNotice("info","new-address","Generated new Bitcoin Address "+t),$("#new-addr").removeAttr("disabled"),loadScript("wallet-legacy/address_modal",(function(){showLabelAddressModal(t)})),c.get_history()}),(function(){$("#new-addr").removeAttr("disabled")}))}),(function(){c.logout()}))}),(function(){$("#new-addr").removeAttr("disabled")}))})),$(".tx_filter a").click((function(){T=0,P=$(this).data("value"),c.get_history()})),$(".tx_display a").click((function(){var e=$(this).data("value");"export"!=e?(H.tx_display=e,buildVisibleView(),c.backupWalletDelayed()):function exportHistory(){loadScript("wallet-legacy/frame-modal",(function(){showFrameModal({title:"Export History",description:"",src:root+"export-history?active="+c.getActiveAddresses().join("|")+"&archived="+c.getArchivedAddresses().join("|")})}))}()})),$("#email-backup-btn").click((function(){!function emailBackup(){c.setLoadingText("Sending email backup"),c.securePost("wallet",{method:"email-backup"},(function(e){c.makeNotice("success","backup-success",e)}),(function(e){c.makeNotice("error","misc-error",e.responseText)}))}()})),$("#dropbox-backup-btn").click((function(){c.openWindow(root+"wallet-legacy/dropbox-login?guid="+n)})),$("#gdrive-backup-btn").click((function(){c.openWindow(root+"wallet-legacy/gdrive-login?guid="+n)})),$("#balance").click((function(){toggleSymbol(),buildVisibleView()})),$("#send-quick").on("show",(function(e,t){var n=$(this);buildSendForm(n,t),n.find(".send").unbind().click((function(){loadScript("wallet-legacy/signer",(function(){startTxUI(n,"quick",initNewTx())}))}))})),$("#send-email").on("show",(function(e,t){var n=$(this);buildSendForm(n,t),n.find(".send").unbind().click((function(){loadScript("wallet-legacy/signer",(function(){startTxUI(n,"email",initNewTx())}))}))})),$("#send-custom").on("show",(function(e,t){var n=$(this);buildSendForm(n,t),n.find(".send").unbind().click((function(){var e=!1;n.find('textarea[name="public-note"]').val()&&n.find(".send-value").each((function(){if($(this).val()<1e-4)return c.makeNotice("error","misc-error","You cannot attach a note to a transaction with an output size less than 0.0001 BTC"),e=!0,!1})),e||loadScript("wallet-legacy/signer",(function(){startTxUI(n,"custom",initNewTx())}))})),n.find('input[name="fees"]').unbind().bind("keyup change",(function(e){"9"!=e.keyCode&&$(this).parent().find(".send-value-usd").val(convert($(this).val()*symbol_btc.conversion,symbol_local.conversion)).text(formatSymbol($(this).val()*symbol_btc.conversion,symbol_local))})),n.find(".reset").unbind().click((function(){buildSendForm(n,!0),n.find('select[name="from"]').trigger("change")}))})),$("#shared-coin").on("show",(function(e,t){var n=$(this);loadScript("wallet-legacy/sharedcoin",(function(){try{buildSendForm(n),SharedCoin.init(n)}catch(e){console.log(e),c.makeNotice("error","misc-error",e)}}),(function(e){c.makeNotice("error","misc-error",e)}))})),$("#send-sms").on("show",(function(e,t){if(!t){var n=$(this);buildSendForm(n),$.ajax({type:"GET",timeout:6e4,url:resource+"wallet-legacy/country_codes.html",success:function(e){n.find('select[name="sms-country-code"]').html(e)},error:function(){c.makeNotice("error","misc-error","Error Downloading SMS Country Codes")}}),n.find(".send").unbind().click((function(){loadScript("wallet-legacy/signer",(function(){var e=initNewTx();startTxUI(n,"sms",e)}))}))}})),$("#address-book").on("show",(function(){var e=$("#address-book-tbl tbody");if(nKeys(_)>0)for(var t in e.empty(),_){var n=$("<tr><td>"+_[t]+'</td><td><div class="addr-book-entry">'+t+'</div></td><td style="width:16px" class="hidden-phone"><img src="'+resource+'delete.png" class="act-delete" /></td></tr>');!function(e){n.find(".act-delete").click((function(){c.deleteAddressBook(e)}))}(t),e.append(n)}})),$('a[data-toggle="tab"]').unbind().on("show",(function(e){$(e.target.hash).trigger("show")})),$("#receive-coins-btn").click((function(){changeView($("#receive-coins"))})),$("#cash-into-coins").click((function(){$(this).attr("href",$(this).attr("href")+c.getPreferredAddress())})),$(".show_adv").click((function(){$(".modal:visible").center()})),$(".download-backup-btn").show(),buildPopovers())}function bindInitial(){$(".resend-code").click((function(){c.setGUID(n,!0)})),$("#reset-two-factor-btn").click((function(){c.openWindow(root+"wallet-legacy/reset-two-factor"+(n?"?guid="+n:""))})),$(".recover-wallet-btn").click((function(){c.openWindow(root+"wallet-legacy/forgot-password"+(n?"?guid="+n:""))})),$(".download-backup-btn").toggle(null!=t).click((function(){if(t){try{var e=!!new Blob}catch(e){}if(e)loadScript("wallet-legacy/filesaver",(function(){var e=new Blob([t],{type:"text/plain;charset=utf-8"});saveAs(e,"wallet.aes.json")}));else window.open(null,null,"width=700,height=800,toolbar=0").document.write('<!DOCTYPE html><html><head></head><body><div style="word-wrap:break-word;" >'+t+"</div></body></html>");!function backupInstructionsModal(){var e=$("#restore-backup-modal");e.modal({keyboard:!0,backdrop:"static",show:!0}),e.find(".btn.btn-secondary").unbind().click((function(){e.modal("hide")}))}()}else c.makeNotice("error","error","No Wallet Data to Download")})),$(".auth-0,.auth-1,.auth-2,.auth-3,.auth-4,.auth-5").unbind().keypress((function(e){13==e.keyCode&&(e.preventDefault(),$("#restore-wallet-continue").click())})),$("#restore-wallet-continue").unbind().click((function(e){e.preventDefault();var i=$.trim($("#restore-guid").val());0!=i.length&&(n!=i?(s=null,c.setGUID(i,!1)):function restoreWallet(){if(!E&&!R)try{R=!0;var e=$("#restore-password");if(o=e.val(),e.val(""),h=(new Date).getTime(),null==t||0==t.length){c.setLoadingText("Validating Authentication key");var i=$.trim($(".auth-"+f).find(".code").val());if(0==i.length||i.length>255)throw"You must enter a Two Factor Authentication code";var a={guid:n,payload:i,length:i.length,method:"get-wallet",format:"plain"};U&&(a.storageToken=U),$.ajax({timeout:6e4,type:"POST",url:root+"wallet",data:a,success:function(e){try{if(null==e||0==e.length)throw"Server Return Empty Wallet Data";"Not modified"!=e&&c.setEncryptedWalletData(e),$(".auth-"+f).hide(),$(".auth-0").show(),internalRestoreWallet((function(){R=!1,bindReady(),didDecryptWallet()}),error)}catch(e){error(e)}},error:function(e){error(e.responseText)}})}else internalRestoreWallet((function(){R=!1,bindReady(),didDecryptWallet()}),error)}catch(e){error(e)}function error(e){R=!1,c.makeNotice("error","misc-error",e),c.sendEvent("error_restoring_wallet")}}())})),$(".modal").on("show",(function(){hidePopovers(),$(this).center()})).on("hidden",(function(){var e=$(".modal:visible"),t=$("#notices").remove();e.length>0?e.find(".modal-body").prepend(t):$("#main-notices-container").append(t)})).on("shown",(function(){hidePopovers();var e=$(this);setTimeout((function(){e.is(":visible")&&e.find(".modal-body").prepend($("#notices").remove())}),100),e.center()}))}this.showNotification=function(e,t){try{var n;window.webkitNotifications&&0==webkitNotifications.checkPermission()?(n=webkitNotifications.createNotification(e.iconUrl,e.title,e.body)).show():window.Notification&&"granted"==window.Notification.permissionLevel()&&(n=new window.Notification(e.title,e).show()),n&&setTimeout((function(){n.cancel()}),t||5e3)}catch(e){}},this.makeNotice=function(e,t,n,i){if(null!=n&&0!=n.length){console.log(n);var o,a=$('<div class="alert alert-block alert-'+e+'"></div>');if(a.text(""+n),$("#"+t).length>0)a.attr("id",t);else $("#notices").append(a).hide().fadeIn(200),o=a,setTimeout((function(){o.fadeOut(250,(function(){$(this).remove()}))}),i||5e3)}},this.pkBytesToSipa=function(e,t){for(var n=new Bitcoin.ECKey(e);e.length<32;)e.unshift(0);if(e.unshift(128),n.getBitcoinAddress().toString()==t);else{if(n.getBitcoinAddressCompressed().toString()!=t)throw"Private Key does not match bitcoin address"+t;e.push(1)}var i=Crypto.SHA256(Crypto.SHA256(e,{asBytes:!0}),{asBytes:!0});return e=e.concat(i.slice(0,4)),B58.encode(e)},this.base58ToSipa=function(e,t){return c.pkBytesToSipa(c.decodePK(e),t)},this.makeWalletJSON=function(e){return c.makeCustomWalletJSON(e,n,s)},this.makeCustomWalletJSON=function(e,t,n){var i=noConvert;"base64"==e?i=base58ToBase64:"hex"==e?i=base58ToHex:"sipa"==e?i=c.base58ToSipa:"base58"==e&&(i=base58ToBase58);var o='{\n\t"guid" : "'+t+'",\n\t"sharedKey" : "'+n+'",\n';for(var a in x&&null!=r&&i==noConvert&&(o+='\t"double_encryption" : '+x+',\n\t"dpasswordhash" : "'+r+'",\n'),H&&(o+='\t"options" : '+JSON.stringify(H)+",\n"),o+='\t"keys" : [\n',A){var s=$.extend({},A[a]);for(var l in 1==s.tag&&delete s.tag,null!=s.priv&&(s.priv=i(s.priv,s.addr)),s)null!==s[l]&&void 0!==s[l]||delete s[l];delete s.balance,o+=JSON.stringify(s)+",\n",atLeastOne=!0}if(atLeastOne&&(o=o.substring(0,o.length-2)),o+="\n\t]",nKeys(_)>0){for(var a in o+=',\n\t"address_book" : [\n',_)o+='\t{"addr" : "'+a+'",\n',o+='\t "label" : "'+_[a]+'"},\n';o=o.substring(0,o.length-2),o+="\n\t]"}return F&&(o+=',\n "hd_wallets" : '+JSON.stringify(F)),nKeys(W)>0&&(o+=',\n\t"tx_notes" : '+JSON.stringify(W)),o+="\n}"},this.get_history=function(e,t){BlockchainAPI.get_history((function(t){parseMultiAddressJSON(t,!1),0==S.length&&T>0?c.setPage(0):buildVisibleView(),e&&e()}),(function(){t&&t()}),P,T*c.getNTransactionsPerPage(),c.getNTransactionsPerPage())},this.deleteAddressBook=function(e){delete _[e],c.backupWalletDelayed(),$("#send-coins").find(".tab-pane").trigger("show",!0)},this.getAllAddresses=function(){var e=[];for(var t in A)e.push(t);return e},this.getPreferredAddress=function(){var e=null;for(var t in A){var n=A[t];if(null==e&&(e=n),null!=n.priv&&(null==e&&(e=n),null==n.tag||0==n.tag)){e=n;break}}return e.addr},this.scanQRCode=function(e,t){var n=$("#qr-code-reader-modal");n.modal({keyboard:!1,backdrop:"static",show:!0}),loadScript("wallet-legacy/qr.code.reader",(function(){QRCodeReader.init(n,(function(t){QRCodeReader.stop(),n.modal("hide"),e(t)}),(function(e){n.modal("hide"),t(e)}))}),t),n.find(".btn.btn-secondary").unbind().click((function(){QRCodeReader.stop(),n.modal("hide"),t()}))},this.getActiveAddresses=function(){var e=[];for(var t in A){var n=A[t];2!=n.tag&&e.push(n.addr)}return e},this.getArchivedAddresses=function(){var e=[];for(var t in A){var n=A[t];2==n.tag&&e.push(n.addr)}return e},this.getLatestBlock=function(){return l},this.deleteNote=function(e){delete W[e],buildVisibleView(),c.backupWalletDelayed()},this.setPage=function(e){T=e,scroll(0,0),c.get_history()},this.loadAdverts=function(e){$.ajax({type:"GET",dataType:"json",url:"https://blockchain.info/adverts_feed",timeout:6e4,success:function(e){e&&e.partners&&function handlePartners(e){var t=$("#partner-home-buttons");if(e.home_buttons&&e.home_buttons.length>0)for(var n in t.show(),t.find("p").empty(),e.home_buttons){var i=e.home_buttons[n],o=$('<a class="btn" style="margin-left:3px;margin-bottom:3px;" href="" target="blank"><img src=""></a>');i.button_class&&o.addClass(i.button_class),o.attr("href",i.link),o.text(" "+i.title),i.image&&o.prepend("<img>").find("img").attr("src",i.image.replace("{0}",resource)),t.find("p").append(o)}else t.hide();$("#send-coins-nav").find("li.send_partner").remove();var a=$("#partners-send-divider");if(e.send_buttons&&e.send_buttons.length>0)for(var n in a.show().next().show(),e.send_buttons){i=e.send_buttons[n];var r=$('<li class="send_partner"><a target="blank"></a></li>');(o=r.find("a")).attr("href",i.link),o.text(" "+i.title),i.image&&o.prepend('<i class="icon-dice" style="background-position:0px;width:16px;height:16px;"></i>').find("i").css("background-image","url("+i.image.replace("{0}",resource)+")"),a.next().after(r)}else a.hide().next().hide();var s=$("#home-deposit-container").empty();if(e.deposit_buttons.length>0){s.show();var c=$('<ul id="myTab" class="nav nav-tabs">'),l={US:[],GB:[],EU:[]},d=[];for(var n in e.deposit_buttons){if(null!=(i=e.deposit_buttons[n]).country_code&&0!=i.country_code.length)null==(g=l[i.country_code])&&(g=[],l[i.country_code]=g),g.push(i);else d.push(i)}var u=0;for(var f in l){if(0!=(g=l[f]).length||0!=d.length){var p=$("<li><a></a></li>");0==u&&p.addClass("active"),(o=p.find("a")).attr("href","#deposit-"+f.toLowerCase()),o.text(" "+f.toUpperCase()),o.prepend("<img>").find("img").attr("src",resource+"flags/"+f.toLowerCase()+".png"),++u,c.append(p)}}c.find("a").click((function(){$(this).tab("show")})),s.append(c);var h=$('<div class="tab-content page-header">');u=0;for(var f in l){var g=l[f],m=$('<div class="tab-pane" style="text-align:right">');if(0==u&&m.addClass("active"),m.attr("id","deposit-"+f.toLowerCase()),0!=(g=g.concat(d)).length){for(var v in g){i=g[v],o=$('<a style="margin-left:3px;" class="btn" target="blank"></a>');i.button_class&&o.addClass(i.button_class),o.attr("href",i.link),o.text(" "+i.title),i.image&&o.prepend("<img>").find("img").attr("src",i.image.replace("{0}",resource)),m.append(o)}++u,h.append(m)}}s.append(h)}else s.hide()}(e.partners)},error:function(e){}})},this.handleURI=function(e,t){loadScript("wallet-legacy/jsuri-1.1.1",(function(){try{var n=new Uri(e),i=new Bitcoin.Address(n.host());t.find('input[name="send-to-address"]').val(i.toString());var o=parseFloat(n.getQueryParamValue("amount"));o>0&&!isNaN(o)&&t.find(".send-value").val(o)}catch(e){console.log(e),c.makeNotice("error","error","Invalid Bitcoin Address or URI")}}),(function(){c.makeNotice("error","error","Invalid Bitcoin Address or URI")}))},this.getPassword=function(e,t,n){e.is(":visible")||(e.trigger("hidden"),e.unbind()),e.modal({keyboard:!1,backdrop:"static",show:!0}),e.center();var i=e.find('input[name="password"]'),o=i,a=!1,r=!1;e.find(".vkeyboard li").unbind().click((function(){var e=$(this),t=e.html();if(e.hasClass("left-shift")||e.hasClass("right-shift"))return $(".letter").toggleClass("uppercase"),$(".symbol span").toggle(),a=!0!==a,r=!1,!1;if(e.hasClass("capslock"))return $(".letter").toggleClass("uppercase"),r=!0,!1;if(e.hasClass("delete")){var n=o.val();return o.val(n.substr(0,n.length-1)),!1}e.hasClass("symbol")&&(t=$("span:visible",e).html()),e.hasClass("space")&&(t=" "),e.hasClass("tab")&&(t="\t"),e.hasClass("return")&&(t="\n"),e.hasClass("uppercase")&&(t=t.toUpperCase()),!0===a&&($(".symbol span").toggle(),!1===r&&$(".letter").toggleClass("uppercase"),a=!1),o.val(o.val()+t)})),i.keypress((function(t){13==t.keyCode&&(t.preventDefault(),e.find(".btn.btn-primary").click())})),i.val("");var s=e.find(".btn.btn-primary");s.click((function(){if(t){n=null;var o=t;t=null,setTimeout((function(){e.modal("hide"),o(i.val())}),10)}else e.modal("hide")}));var l=e.find(".btn.btn-secondary");l.click((function(){if(n){var i=n;n=null,t=null,setTimeout((function(){e.modal("hide");try{i()}catch(e){c.makeNotice("error","misc-error",e)}}),10)}else e.modal("hide")})),e.on("hidden",(function(){if(i.unbind(),l.unbind(),s.unbind(),e.unbind(),n){var o=n;n=null,t=null,setTimeout((function(){try{o()}catch(e){c.makeNotice("error","misc-error",e)}}),10)}}))},this.makePairingQRCode=function(e,t){c.getMainPassword((function(){loadScript("wallet-legacy/jquery.qrcode",(function(){try{1==t?c.securePost("wallet",{method:"pairing-encryption-password"},(function(t){e($("<div></div>").qrcode({width:300,height:300,text:"1|"+n+"|"+c.encrypt(s+"|"+Crypto.util.bytesToHex(UTF8.stringToBytes(o)),t,10)}))}),(function(e){c.makeNotice("error","misc-error",e)})):0==t&&e($("<div></div>").qrcode({width:300,height:300,text:n+"|"+s+"|"+o}))}catch(e){c.makeNotice("error","misc-error",e)}}))}),(function(){c.logout()}))},this.getMainPassword=function(e,t){if(h>(new Date).getTime()-6e4)return e(o);c.getPassword($("#main-password-modal"),(function(n){if(o==n){if(h=(new Date).getTime(),e)try{e(o)}catch(e){c.makeNotice("error","misc-error",e)}}else if(c.makeNotice("error","misc-error","Password incorrect."),t)try{t()}catch(e){c.makeNotice("error","misc-error",e)}}),t)},this.getSecondPassword=function(e,t){if(x&&null==a)c.getPassword($("#second-password-modal"),(function(n){try{if(c.validateSecondPassword(n)){if(e)try{e(n)}catch(e){console.log(e),c.makeNotice("error","misc-error",e)}}else if(c.makeNotice("error","misc-error","Password incorrect."),t)try{t()}catch(e){c.makeNotice("error","misc-error",e)}}catch(e){if(t)try{t()}catch(e){c.makeNotice("error","misc-error",e)}}}),t);else if(e)try{e(a)}catch(e){c.makeNotice("error","misc-error",e)}},this.getIsInitialized=function(){return E},this.connectWebSocket=function(){webSocketConnect(wsSuccess)},this.quickSendNoUI=function(e,t,n){loadScript("wallet-legacy/signer",(function(){c.getSecondPassword((function(){try{var i=initNewTx();i.webworker_resource_prefix="",i.from_addresses=c.getActiveAddresses(),i.to_addresses.push({address:new Bitcoin.Address(e),value:Bitcoin.Util.parseValue(t)}),i.addListener(n),i.start()}catch(e){n.on_error(e)}}),(function(e){n.on_error(e)}))}))},this.backupWalletDelayed=function(e,t,n,i){u&&(clearInterval(u),u=null),u=setTimeout((function(){c.backupWallet(e,t,n,i)}),3e3)},this.backupWallet=function(e,t,n){u&&(clearInterval(u),u=null);var _errorcallback=function(e){c.sendEvent("on_backup_wallet_error"),c.makeNotice("error","misc-error","Error Saving Wallet: "+e,1e4),getWallet(),buildVisibleView(),null!=n&&n(e)};try{if(null==e&&(e="update"),0==nKeys(A))throw"Addresses Length 0";var i=c.makeWalletJSON(),a=c.encryptWallet(i,o);if(0==a.length)throw"Error encrypting the JSON output";c.decryptWallet(a,o,(function(n){try{var i=d;c.setLoadingText("Saving wallet"),c.setEncryptedWalletData(a);var o=d,r={length:a.length,payload:a,checksum:o,old_checksum:i,method:e,format:"plain",language:I};O&&(r.active=c.getActiveAddresses().join("|")),c.securePost("wallet",r,(function(e){!function checkWalletChecksum(e,t,n){var i={method:"wallet.aes.json",format:"json",checksum:e};c.securePost("wallet",i,(function(e){e.payload&&"Not modified"!=e.payload?n&&n():t&&t()}),(function(e){n&&n()}))}(o,(function(){for(var n in A){var i=A[n];1==i.tag&&delete i.tag}c.makeNotice("success","misc-success",e),buildVisibleView(),null!=t&&t(),c.sendEvent("on_backup_wallet_success")}),(function(){_errorcallback("Checksum Did Not Match Expected Value")}))}),(function(e){_errorcallback(e.responseText)}))}catch(e){_errorcallback(e)}}))}catch(e){_errorcallback(e)}},this.isBase58=function(e,t){for(var n=0;n<e.length;++n)if(e[n]<0||e[n]>58)return!1;return!0},this.encrypt=function(e,t,n){return Crypto.AES.encrypt(e,t,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:n})},this.encryptWallet=function(e,t){return JSON.stringify({pbkdf2_iterations:c.getMainPasswordPbkdf2Iterations(),version:2,payload:c.encrypt(e,t,c.getMainPasswordPbkdf2Iterations())})},this.decryptWallet=function(e,t,n,i){try{c.setLoadingText("Decrypting Wallet"),c.sendEvent("on_wallet_decrypt_start");var _success=function(e,t){c.sendEvent("on_wallet_decrypt_finish"),null!=n&&n(e,t)},_error=function(e){c.sendEvent("on_wallet_decrypt_finish"),null!=i&&i(e)},o=null;try{o=$.parseJSON(e)}catch(e){}var decryptNormal=function(){try{var e=Crypto.AES.decrypt(o.payload,t,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:o.pbkdf2_iterations}),n=$.parseJSON(e);_success(n,o)}catch(e){_error("Error Decrypting Wallet. Please check your password is correct.")}};if(o&&o.payload&&o.pbkdf2_iterations){if(2!=o.version){var a=c.getGuid();null==a&&(a=""),window.location=root+"wallet/#/login/"+a}if(o.pbkdf2_iterations>0){var r=$("#decrypting-progress-modal"),s=setTimeout((function(){r.modal({keyboard:!1,backdrop:"static",show:!0}),r.center()}),500);c.decryptWebWorker(o.payload,t,o.pbkdf2_iterations,(function(e){clearTimeout(s),r.modal("hide");try{var t=$.parseJSON(e);_success(t,o)}catch(e){decryptNormal()}}),(function(e){clearTimeout(s),r.modal("hide"),decryptNormal()}))}else decryptNormal()}else c.decrypt(e,t,10,(function(e){try{var t=$.parseJSON(e);try{_success(t)}catch(e){console.log(e)}return!0}catch(e){return!1}}),(function(){_error("Error Decrypting Wallet. Please check your password is correct.")}))}catch(e){_error(e)}},this.getWebWorkerLoadPrefix=function(){return resource+"wallet-legacy/"},this.decryptWebWorker=function(e,t,n,i,o){var a=!1,error=function(e){a||(o(e),a=!0)};try{var r=new Worker(c.getWebWorkerLoadPrefix()+"signer"+(min?".min.js":".js"));r.addEventListener("message",(function(e){var t=e.data;try{switch(t.cmd){case"on_decrypt":i(t.data),r.terminate();break;case"on_error":throw t.e}}catch(e){r.terminate(),error(e)}}),!1),r.addEventListener("error",(function(e){error(e)})),r.postMessage({cmd:"load_resource",path:c.getWebWorkerLoadPrefix()+"bitcoinjs"+(min?".min.js":".js")}),r.postMessage({cmd:"decrypt",data:e,password:t,pbkdf2_iterations:n})}catch(e){error(e)}},this.decrypt=function(e,t,n,i,o){try{if(null!=(a=Crypto.AES.decrypt(e,t,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:n}))&&a.length>0&&i(a))return a}catch(e){console.log(e)}if(10!=n)try{if(null!=(a=Crypto.AES.decrypt(e,t,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:10}))&&a.length>0&&i(a))return a}catch(e){console.log(e)}try{if(null!=(a=Crypto.AES.decrypt(e,t))&&a.length>0&&i(a))return a}catch(e){console.log(e)}try{if(null!=(a=Crypto.AES.decrypt(e,t,{mode:new Crypto.mode.OFB(Crypto.pad.iso7816),iterations:1}))&&a.length>0&&i(a))return a}catch(e){console.log(e)}try{var a;if(null!=(a=Crypto.AES.decrypt(e,t,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:1}))&&a.length>0&&i(a))return a}catch(e){console.log(e)}return o&&o(),null},this.handleNTPResponse=function(e,t){var n=(new Date).getTime();if(e.clientTimeDiff&&e.serverTime){var i=n-e.serverTime,o=(i-(e.clientTimeDiff-n+t-i)/2)/2;V?K=(K+o)/2:(K=o,V=!0,MyStore.put("server_time_offset",""+K)),console.log("Server Time offset "+K+"ms - This offset "+o)}},this.setGUID=function(e,t){if(E)throw"Cannot Set GUID Once Initialized";if(!e||0==e.length)throw"Invalid GUID";c.setLoadingText("Downloading Wallet"),$("#initial_error,#initial_success").remove();var i=$("#restore-wallet-continue");i.prop("disabled",!0);var o=(new Date).getTime(),a={format:"json",resend_code:t,ct:o};d&&(a.checksum=d),s&&(a.sharedKey=s),U&&(a.storageToken=U),$.ajax({type:"GET",dataType:"json",url:root+"wallet/"+encodeURIComponent(e),data:a,timeout:6e4,success:function(e){c.handleNTPResponse(e,o),i.prop("disabled",!1),e.guid?($(".auth-"+f).hide(),g=e.extra_seed,n=e.guid,f=e.auth_type,e.real_auth_type,O=e.sync_pubkeys,e.payload&&e.payload.length>0&&"Not modified"!=e.payload&&c.setEncryptedWalletData(e.payload),c.sendEvent("did_set_guid"),war_checksum=e.war_checksum,setLocalSymbol(e.symbol_local),setBTCSymbol(e.symbol_btc),$("#restore-guid").val(n),$(".auth-"+f).show(),e.initial_error&&c.makeNotice("error","misc-error",e.initial_error),e.initial_success&&c.makeNotice("success","misc-success",e.initial_success),MyStore.get("guid",(function(e){e!=n&&(MyStore.remove("guid"),MyStore.remove("multiaddr"),MyStore.remove("payload"))})),e.language&&I!=e.language&&c.setLanguage(e.language)):c.makeNotice("error","misc-error","Server returned null guid.")},error:function(e){i.prop("disabled",!1),MyStore.get("guid",(function(t){c.sendEvent("did_fail_set_guid");try{var n=$.parseJSON(e.responseText);return n.authorization_required&&loadScript("wallet-legacy/poll-for-session-guid",(function(){pollForSessionGUID()})),void(n.initial_error&&c.makeNotice("error","misc-error",n.initial_error))}catch(e){}e.responseText?c.makeNotice("error","misc-error",e.responseText):c.makeNotice("error","misc-error","Error changing wallet identifier")}))}})},this.decryptPK=function(e){if(x){if(null==a)throw"Cannot decrypt private key without a password";return c.decrypt(e,s+a,c.getSecondPasswordPbkdf2Iterations(),c.isBase58)}return e},this.decodePK=function(e){if(!e)throw"null PK passed to decodePK";var t=c.decryptPK(e);return null!=t?B58.decode(t):null},this.signmessage=function(e,t){var n=A[e];if(!n.priv)throw"Cannot sign a watch only address";var i=c.decodePK(n.priv),o=new Bitcoin.ECKey(i);return Bitcoin.Message.signMessage(o,t,n.addr)},this.validateSecondPassword=function(e){var t=Crypto.SHA256(s+e,{asBytes:!0}),n=hashPassword(t,c.getSecondPasswordPbkdf2Iterations()-1);if(n==r)return a=e,!0;if(10!=c.getSecondPasswordPbkdf2Iterations()&&hashPassword(t,9)==r)return a=e,r=n,!0;return(Crypto.util.bytesToHex(t)==r||Crypto.SHA256(e)==r)&&(a=e,r=n,!0)},this.runCompressedCheck=function(){var e=[],t={};for(var n in A){var i=A[n];if(null!=i.priv){var o=c.decodePK(i.priv),a=new Bitcoin.ECKey(o),r=a.getBitcoinAddress().toString(),s=a.getBitcoinAddressCompressed().toString();i.addr!=r&&(t[r]=i.priv,e.push(r)),i.addr!=s&&(t[s]=i.priv,e.push(s))}}0==e.length&&alert("to_check length == 0"),BlockchainAPI.get_balances(e,(function(e){var n=0;for(var i in e){var o=e[i].final_balance;if(o>0){var a=new Bitcoin.ECKey(c.decodePK(t[i])),r=a.getBitcoinAddress().toString();c.addPrivateKey(a,{compressed:r!=i,app_name:IMPORTED_APP_NAME,app_version:IMPORTED_APP_VERSION})&&alert(formatBTC(o)+" claimable in address "+i)}n+=o}alert(formatBTC(n)+" found in compressed addresses"),n>0&&c.backupWallet("update",(function(){c.get_history()}))}))},this.checkAllKeys=function(e){for(var t in A){var n=A[t];if(null==n.addr)throw"Null Address Found in wallet "+t;if(null==n.addr.toString())throw"Error decoding wallet address "+n.addr;if(null!=n.priv){var i=c.decodePK(n.priv),o=new Bitcoin.ECKey(i),a=o.getBitcoinAddress().toString();if(a!=n.addr&&o.getBitcoinAddressCompressed().toString()!=n.addr)throw"Private key does not match bitcoin address "+n.addr+" != "+a;e&&(n.priv=encodePK(i))}}c.makeNotice("success","wallet-success","Wallet verified.")},this.setMainPassword=function(e){c.getMainPassword((function(){o=e,c.backupWallet("update",(function(){c.logout()}),(function(){c.logout()}))}))},this.logout=function(){D||$.ajax({type:"GET",timeout:6e4,url:root+"wallet-legacy/logout",data:{format:"plain"},success:function(e){window.location.reload()},error:function(){window.location.reload()}})},this.sweepAddressesModal=function(e,t){c.getSecondPassword((function(){var n=$("#sweep-address-modal");n.modal("show"),BlockchainAPI.get_balance(e,(function(e){n.find(".balance").text("Amount: "+formatBTC(e))}),(function(){n.find(".balance").text("Error Fetching Balance")}));var i=n.find('select[name="change"]');buildSelect(i,!0),n.find(".btn.btn-primary").unbind().click((function(){loadScript("wallet-legacy/signer",(function(){BlockchainAPI.get_balance(e,(function(n){var o=initNewTx(),a=i.val();"any"==a&&(a=c.getPreferredAddress()),o.fee=o.base_fee,o.to_addresses.push({address:new Bitcoin.Address(a),value:BigInteger.valueOf(n).subtract(o.fee)}),o.from_addresses=e,o.extra_private_keys=t,o.start()}),(function(){c.makeNotice("error","misc-error","Error Getting Address Balance")}))})),n.modal("hide")})),n.find(".btn.btn-secondary").unbind().click((function(){n.modal("hide")}))}))},this.openWindow=function(e){return!function _hasPopupBlocker(e){var t=!1;try{void 0!==e&&e?(e&&e.closed||e&&e.test)&&(t=!1):t=!0}catch(e){}return t}(window.open(e,null,"scroll=1,status=1,location=1,toolbar=1"))||(c.makeNotice("error","misc-error","Popup Blocked. Try and click again."),!1)},this.detectPrivateKeyFormat=function(e){if(/^5[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{50}$/.test(e))return"sipa";if(/^[LK][123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{51}$/.test(e))return"compsipa";if(/^[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{44}$/.test(e)||/^[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{43}$/.test(e))return"base58";if(/^[A-Fa-f0-9]{64}$/.test(e))return"hex";if(/^[ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789=+\/]{44}$/.test(e))return"base64";if(/^6P[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{56}$/.test(e))return"bip38";if(/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{21}$/.test(e)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{25}$/.test(e)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{29}$/.test(e)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{30}$/.test(e)){var t=Crypto.SHA256(e+"?",{asBytes:!0});if(0===t[0]||1===t[0])return"mini"}throw"Unknown Key Format "+e},this.privateKeyStringToKey=function(e,t){var n=null;if("base58"==t)n=B58.decode(e);else if("base64"==t)n=Crypto.util.base64ToBytes(e);else if("hex"==t)n=Crypto.util.hexToBytes(e);else if("mini"==t)n=function parseMiniKey(e){var t=Crypto.SHA256(e+"?");switch(t.slice(0,2)){case"00":return Crypto.SHA256(e,{asBytes:!0});case"01":var n=Crypto.util.hexToBytes(t.slice(2,4))[0],i=Math.round(Math.pow(2,n/4));return Crypto.PBKDF2(e,"Satoshi Nakamoto",32,{iterations:i,asBytes:!0});default:console.log("invalid key")}}(e);else if("sipa"==t){(i=B58.decode(e)).shift(),n=i.slice(0,i.length-4)}else{if("compsipa"!=t)throw"Unsupported Key Format";var i;(i=B58.decode(e)).shift(),i.pop(),n=i.slice(0,i.length-4)}if(32!=n.length)throw"Result not 32 bytes in length";return new Bitcoin.ECKey(n)},$(document).ready((function(){if($.isEmptyObject({})&&$.isEmptyObject([])){$("input,button,select").attr("autocomplete","off"),c.loadAdverts();var e=$(document.body);if(n=e.data("guid"),s=e.data("sharedkey"),I=e.data("language"),!c.skip_init){MyStore.get("storage_token",(function(e){U=e})),MyStore.get("server_time_offset",(function(e){K=parseInt(e),isNaN(K)&&(K=0)})),bindInitial();var t=$("#restore-guid").val();n&&36==n.length?c.setGUID(n,!1):t&&t.length>0?$("#restore-wallet-continue").click():isExtension||window.location.href.indexOf("/login")>0?MyStore.get("guid",(function(e){e&&36==e.length?c.setGUID(e,!1):$("#signup-btn").show()})):$("#signup-btn").show(),top.location!=self.location&&(top.location=self.location.href),e.click((function(){p&&(clearTimeout(p),p=setTimeout(c.logout,c.getLogoutTime())),rng_seed_time()})).keypress((function(){p&&(clearTimeout(p),p=setTimeout(c.logout,c.getLogoutTime())),rng_seed_time()})).mousemove((function(e){e&&rng_seed_int(e.clientX*e.clientY,16)})),$(".auth-"+f).show(),(i=$("#restore-wallet")).show();var o=!1;$(document).keydown((function(e){try{if(17!=e.keyCode&&67!=e.keyCode||(o=!0),o&&67==e.keyCode){var t=$.trim(function getSelectionText(){var e,t="";if(window.getSelection){if((e=window.getSelection()).rangeCount){var n=e.getRangeAt(0).cloneContents(),i=document.createElement("div");i.appendChild(n),t=i.innerText}}else document.selection&&"Text"==document.selection.type&&(t=document.selection.createRange().htmlText);return t}()),n=A[t];null!=n&&null==n.priv&&$("#watch-only-copy-warning-modal").modal("show")}}catch(e){console.log(e)}})).keyup((function(e){17!=e.keyCode&&67!=e.keyCode||(o=!1)})).ajaxStart((function(){setLogoutImageStatus("loading_start"),$(".loading-indicator").fadeIn(200)})).ajaxStop((function(){setLogoutImageStatus("loading_stop"),$(".loading-indicator").hide()}))}}else c.makeNotice("error","error","Object.prototype has been extended by a browser extension. Please disable this extensions and reload the page.")}))};