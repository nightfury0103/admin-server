"use strict";(self.webpackChunkblockchain_wallet_v4_frontend=self.webpackChunkblockchain_wallet_v4_frontend||[]).push([[7946],{"./src/modals/Brokerage/Banks/AddBankYapily/index.tsx":(e,t,a)=>{a.r(t),a.d(t,{default:()=>M});var n=a("../../node_modules/react/index.js"),o=a("../../node_modules/react-redux/es/index.js"),r=a("../../node_modules/redux/es/redux.js"),l=a("./src/components/Flyout/index.tsx"),s=a("./src/data/index.ts"),i=a("./src/data/types.ts"),c=a("./src/providers/ModalEnhancer/index.tsx"),d=a("./src/modals/components/index.tsx"),u=a("./src/modals/Brokerage/Banks/AddBankStatus/index.tsx"),m=a("../../node_modules/ramda/es/lift.js"),h=a("../../node_modules/ramda/es/path.js");const getData=e=>{const t=s.wl.wx.zT.getBankCredentials(e);return(0,m.Z)((e=>({bankCredentials:e,entity:(0,h.Z)(["attributes","entity"],e)})))(t)};var g=a("./node_modules/react-intl/lib/src/components/message.js"),y=a("../../node_modules/moment/moment.js"),p=a.n(y),b=a("../../node_modules/styled-components/dist/styled-components.browser.esm.js"),k=a("../blockchain-info-components/src/index.js");const E=b.ZP.div`
  display: flex;
  flex-direction: column;
  height: 100%;
`,f=(0,b.ZP)(k.xv)`
  display: flex;
  align-items: center;
  width: 100%;
  font-weight: 600;
  font-size: 20px;
`,x=b.ZP.div`
  display: flex;
  justify-content: space-between;
  align-items: center;
  cursor: pointer;

  > span:last-child {
    size: 10px;
    transition: transform 0.2s;
    color: ${e=>e.theme.grey600};

    &.active {
      transform: rotate(180deg);
    }
  }
`,w=(0,b.ZP)(l.Dx)`
  font-weight: 600;
  line-height: 1.5;
  color: ${e=>e.theme.grey900};
`,C=b.ZP.div`
  max-height: 0;
  margin-top: 0;
  overflow: hidden;
  transition: max-height, margin-top 0.3s;
  &.isToggled {
    max-height: 100%;
    margin-top: 12px;
  }
`,v=(0,b.ZP)(l.Dx)`
  font-size: 14px;
  font-weight: 500;
  color: ${e=>e.theme.grey600};
  line-height: 1.5;
  a {
    color: ${e=>e.theme.blue600};
    cursor: pointer;
    text-decoration: none;
  }
`,A=(0,b.ZP)(l.o9)`
  display: flex;
  flex-direction: column;
  justify-content: flex-end;
  height: 100%;
`,DropdownItem=({bodyText:e,titleText:t})=>{const[a,o]=(0,n.useState)(!1);return n.createElement(l.X2,null,n.createElement(x,{onClick:()=>o(!a)},n.createElement(w,null,t),n.createElement(k.JO,{name:"chevron-down",className:a?"active":""})),n.createElement(C,{className:a?"isToggled":""},n.createElement(v,null,e)))},template_success=e=>{const{entity:t}=e,a="Safeconnect(UK)"===t?"SafeConnect":"SafeConnect (UAB)",o=p()();return o.add(90,"day"),n.createElement(E,null,n.createElement(l.o9,{style:{paddingBottom:"24px"}},n.createElement(f,null,n.createElement(k.Ee,{name:"safe-connect",size:"20px",style:{marginRight:"28px"}}),n.createElement(g.Z,{id:"modals.brokerage.authorize.title",defaultMessage:"{entityName}",values:{entityName:a}}))),n.createElement(DropdownItem,{bodyText:n.createElement(g.Z,{id:"modals.brokertitleage.authorize.data_sharing",defaultMessage:"{entityName} will retrieve your bank data based on your request and provide this information to our.com.",values:{entityName:a}}),titleText:n.createElement(g.Z,{id:"modals.brokerage.authorize.data_sharing",defaultMessage:"Data Sharing"})}),n.createElement(DropdownItem,{bodyText:n.createElement(g.Z,{id:"modals.brokerage.authorize.secure_connection",defaultMessage:"Data is securely retrieved in read-only format and only for the duration agreed with you. You have the right to withdraw your consent at any time."}),titleText:n.createElement(g.Z,{id:"modals.brokerage.authorize.secure_connection.title",defaultMessage:"Secure Connection"})}),n.createElement(DropdownItem,{bodyText:"SafeConnect"===a?n.createElement(g.Z,{id:"modals.brokerage.authorize.fca",defaultMessage:"our.com is an agent of {entityName} Ltd. {entityName} Ltd is authorised and regulated by the Financial Conduct Authority under the Payment Service Regulations 2017 [827001] for the provision of Account Information and Payment Initiation services.",values:{entityName:a}}):n.createElement(g.Z,{id:"modals.brokerage.authorize.bol",defaultMessage:"SafeConnect UAB is authorised and regulated by the Bank of Lithuania under Payments Law (LB002045) for the provision of Account Information and Payment Initiation services."}),titleText:"SafeConnect"===a?n.createElement(g.Z,{id:"modals.brokerage.authorize.fca.title",defaultMessage:"FCA Authorisation"}):n.createElement(g.Z,{id:"modals.brokerage.authorize.bol.title",defaultMessage:"Bank of Lithuania Authorisation"})}),n.createElement(l.X2,null,n.createElement(v,null,n.createElement(g.Z,{id:"modals.brokerage.authorize.data",defaultMessage:"In order to share your bank account data with our.com, you will now be securely redirected to your bank to confirm your consent for {entityName} to read the following information:",values:{entityName:a}})),n.createElement(v,{style:{margin:"15px 0"}},"•"," ",n.createElement(g.Z,{id:"modals.brokerage.authorize.identification_details",defaultMessage:"Identification details"})),n.createElement(v,null,"•"," ",n.createElement(g.Z,{id:"modals.brokerage.authorize.account_details",defaultMessage:"Account(s) details"}))),n.createElement(DropdownItem,{bodyText:n.createElement(n.Fragment,null,n.createElement(g.Z,{id:"modals.brokerage.authorize.about_access_ais",defaultMessage:"{entityName} will then use these details with our.com solely for the purposes of buying cryptocurrencies. This access is valid until {expirationDate}, you can cancel consent at any time via the our.com settings or via your bank. This request is not a one-off, you will continue to receive consent requests as older versions expire.",values:{entityName:a,expirationDate:o.format("Do MMM YYYY")}}),"SafeConnect"!==a&&n.createElement(g.Z,{id:"modals.brokerage.authorize.bol.terms",defaultMessage:"View SafeConnect UAB <a>Terms and Conditions</a> for more information.",values:{a:e=>n.createElement("a",{href:"https://yapi.ly/GDNT",rel:"noopener noreferrer",target:"_blank"},e)}})),titleText:n.createElement(g.Z,{id:"modals.brokerage.authorize.about_access.title",defaultMessage:"About the Access"})}),n.createElement(l.X2,null),n.createElement(A,null,n.createElement(k.zx,{nature:"primary","data-e2e":"obApprove",type:"submit",fullwidth:!0,height:"48px",onClick:()=>{e.brokerageActions.setAddBankStep({addBankStep:i.Hb.ADD_BANK_CONNECT})}},n.createElement(g.Z,{id:"copy.approve",defaultMessage:"Approve"})),n.createElement(k.zx,{nature:"light-red","data-e2e":"obDeny",type:"button",fullwidth:!0,height:"48px",color:"red400",style:{marginTop:"16px"},onClick:()=>{e.handleClose()}},n.createElement(g.Z,{id:"copy.deny",defaultMessage:"Deny"}))))},_=(0,o.connect)((e=>({data:getData(e)})),(e=>({brokerageActions:(0,r.bindActionCreators)(s.Nw.wx.brokerage,e),buySellActions:(0,r.bindActionCreators)(s.Nw.wx.buySell,e)})))((e=>e.data.cata({Failure:()=>n.createElement(l.ub,{action:"close","data-e2e":"addBankClose",handler:e.handleClose}),Loading:()=>n.createElement(d.H,null),NotAsked:()=>n.createElement(d.H,null),Success:t=>n.createElement(template_success,Object.assign({},e,t))})));var B=a("../blockchain-wallet-v4/src/index.ts"),Z=a("./src/components/DataError/index.tsx");const selectors=e=>{const t=s.wl.wx.zT.getBankCredentials(e),a=s.wl.wx.zT.getIsFlow(e);return(0,m.Z)((e=>({bankCredentials:e,isFlow:a})))(t)},Connect_template_success=e=>{var t,a,o,r,l,s,i,c;const u=null===(a=null===(t=e.account)||void 0===t?void 0:t.attributes)||void 0===a?void 0:a.media,m=u&&u.length&&u[0].source||"";return n.createElement(d.zK,null,n.createElement(d.YX,Object.assign({},e),n.createElement(g.Z,{id:"copy.connect_to_your_bank",defaultMessage:"Connect to your bank"})),n.createElement(d.Oi,null,n.createElement(d.NA,{logo:m,qrCode:null===(r=null===(o=e.account)||void 0===o?void 0:o.attributes)||void 0===r?void 0:r.qrcodeUrl},e.isFlow?n.createElement(g.Z,{id:"modals.brokerage.pay_via_mobile",defaultMessage:"Pay via mobile"}):n.createElement(g.Z,{id:"modals.brokerage.link_via_mobile",defaultMessage:"Link via mobile"})),n.createElement(d.Hr,null),n.createElement(d.$0,null,n.createElement(d.dC,{authUrl:null===(s=null===(l=e.account)||void 0===l?void 0:l.attributes)||void 0===s?void 0:s.authorisationUrl},e.isFlow?n.createElement(g.Z,{id:"modals.brokerage.pay_via_desktop",defaultMessage:"Pay via desktop"}):n.createElement(g.Z,{id:"modals.brokerage.link_via_desktop",defaultMessage:"Link via desktop"})),n.createElement(d.mZ,{qrCode:null===(c=null===(i=e.account)||void 0===i?void 0:i.attributes)||void 0===c?void 0:c.qrcodeUrl}))))},N=(0,o.connect)((e=>({account:s.wl.wx.zT.getAccount(e),data:selectors(e),walletCurrency:s.wl.vE.Xd.getCurrency(e).getOrElse("USD")})),(e=>({brokerageActions:(0,r.bindActionCreators)(s.Nw.wx.brokerage,e)})))((e=>{const fetchBank=()=>{e.walletCurrency&&!B.Nt.Success.is(e.data)&&e.brokerageActions.fetchBankLinkCredentials(e.walletCurrency),e.brokerageActions.fetchBankTransferUpdate(e.yapilyBankId)};return(0,n.useEffect)((()=>{e.brokerageActions.setBankDetails({account:void 0}),fetchBank()}),[e.walletCurrency]),e.data.cata({Failure:()=>n.createElement(Z.Z,{onClick:fetchBank}),Loading:()=>n.createElement(d.gb,{text:d.Ue.LOADING}),NotAsked:()=>n.createElement(d.gb,{text:d.Ue.LOADING}),Success:t=>n.createElement(Connect_template_success,Object.assign({},e,t))})})),SelectBank_selectors_getData=e=>{const t=s.wl.wx.zT.getBankCredentials(e),a=s.wl.wx.wd.getSBPaymentMethods(e);return(0,m.Z)(((e,t)=>({bankCredentials:e,paymentMethods:t})))(t,a)},SelectBank_template_success=e=>{const[t,a]=(0,n.useState)(e.bankCredentials.attributes.institutions);return n.createElement(d.zK,null,n.createElement(d.EA,Object.assign({},e),n.createElement(g.Z,{id:"copy.find_your_bank",defaultMessage:"Find Your Bank"})),n.createElement(d.Vd,null,n.createElement(d.mf,{onChange:t=>{const{value:n}=t.target,o=e.bankCredentials.attributes.institutions.filter((e=>e.name.toLowerCase().match(n.toLowerCase())));a(o)},placeholder:"Search",type:"text"}),n.createElement(d.rD,null)),t.map((t=>n.createElement(d.FP,{key:t.id,institution:t,onClick:()=>{e.setYapilyBankId(t.id),e.brokerageActions.setAddBankStep({addBankStep:i.Hb.ADD_BANK_AUTHORIZE})}}))))},SelectBank_mapStateToProps=e=>({data:SelectBank_selectors_getData(e),walletCurrency:s.wl.vE.Xd.getCurrency(e).getOrElse("USD")}),SelectBank_mapDispatchToProps=e=>({brokerageActions:(0,r.bindActionCreators)(s.Nw.wx.brokerage,e),buySellActions:(0,r.bindActionCreators)(s.Nw.wx.buySell,e)}),D=((0,o.connect)(SelectBank_mapStateToProps,SelectBank_mapDispatchToProps),(0,o.connect)(SelectBank_mapStateToProps,SelectBank_mapDispatchToProps)((e=>{const fetchBank=()=>{e.brokerageActions.fetchBankLinkCredentials(e.walletCurrency)};(0,n.useEffect)((()=>{fetchBank()}),[]);const{data:t}=e;return t.cata({Failure:()=>n.createElement(Z.Z,{onClick:fetchBank}),Loading:()=>n.createElement(d.gb,{text:d.Ue.GETTING_READY}),NotAsked:()=>n.createElement(d.gb,{text:d.Ue.GETTING_READY}),Success:t=>n.createElement(SelectBank_template_success,Object.assign({},t,e))})})));class S extends n.PureComponent{constructor(){super(...arguments),this.state={show:!1,yapilyBankId:""},this.handleClose=()=>{this.setState({show:!1}),setTimeout((()=>{this.props.close()}),l.x9)},this.setYapilyBankId=e=>{this.setState({yapilyBankId:e})}}componentDidMount(){this.setState({show:!0})}render(){return n.createElement(l.ZP,Object.assign({},this.props,{onClose:this.handleClose,isOpen:this.state.show,"data-e2e":"addBankModal"}),this.props.step===i.Hb.ADD_BANK&&n.createElement(l.FK,null,n.createElement(D,{setYapilyBankId:this.setYapilyBankId,handleClose:this.handleClose})),this.props.step===i.Hb.ADD_BANK_CONNECT&&n.createElement(l.FK,null,n.createElement(N,{handleClose:this.handleClose,yapilyBankId:this.state.yapilyBankId})),this.props.step===i.Hb.ADD_BANK_AUTHORIZE&&n.createElement(l.FK,null,n.createElement(_,{handleClose:this.handleClose})),this.props.step===i.Hb.ADD_BANK_STATUS&&n.createElement(l.FK,null,n.createElement(u.Z,{handleClose:this.handleClose,yapilyBankId:this.state.yapilyBankId})),this.props.step===i.Hb.LOADING&&n.createElement(l.FK,null,n.createElement(d.gb,{text:d.Ue.LOADING})))}}const T=(0,o.connect)((e=>({step:s.wl.wx.zT.getAddBankStep(e)}))),M=(0,r.compose)((0,c.Z)(i.tl.ADD_BANK_YAPILY_MODAL,{transition:l.x9}),T)(S)}}]);