function precisionToSatoshiBN(e){return Bitcoin.Util.parseValue(e).divide(BigInteger.valueOf(Math.pow(10,sShift(symbol_btc)).toString()))}function precisionToBTC(e){return Bitcoin.Util.formatValue(precisionToSatoshiBN(e))}function precisionFromSatoshi(e){return Bitcoin.Util.formatValue(e.multiply(BigInteger.valueOf(Math.pow(10,sShift(symbol_btc)))))}function precisionFromBTC(e){return precisionFromSatoshi(Bitcoin.Util.parseValue(e))}function formatPrecision(e){return formatBTC(precisionToSatoshiBN(e).toString())}var MyWallet=new function(){var e,t,i,r,c,h,k,_=this;this.skip_init=!1;var S,x,C,P,N,B,E,W,L=0,O=0,R=0,F=0,H=0,J={},Q=[],V=!1,z=0,X=0,ee=1e3,te={},ne=!0,oe=5e3,ie={},re=[],se=!1,ce="en",de=0,le=!1,ue=!1,fe=!1,pe=!1,he=!1,ge=null,me=null,ve={pbkdf2_iterations:5e3,fee_policy:0,html5_notifications:!1,logout_time:6e5,tx_display:0,always_keep_local_backup:!1,transactions_per_page:30,additional_seeds:[]};function ah(e,t){for(var i=Crypto.SHA256(e,{asBytes:!0}),r=1;r<t;++r)i=Crypto.SHA256(i,{asBytes:!0});return Crypto.util.bytesToHex(i)}function M(){try{$(".popover").remove()}catch(e){}}function aT(e,t){return e.click((function(){!function A(e,t){loadScript("wallet-legacy/frame-modal",(function(){showFrameModal({title:"Transaction Summary",description:"",src:root+"tx-summary/"+e+"?result="+t+"&symbol_btc="+symbol_btc.code+"&symbol_local="+symbol_local.code})}))}(t.txIndex,t.result)})),e.find(".show-note").unbind("mouseover").mouseover((function(){!function aN(e,t,i){!function(e,t,i){e=$(e);try{e.data("popover").tip().remove(),e.removeData("popover")}catch(e){}var r="Note";ie[i]&&(r+=' <span style="float:right"><img src="'+resource+'delete.png" /></span>'),e.popover({title:r,trigger:"manual",content:t}),e.popover("show"),e.unbind("mouseleave").mouseleave((function(){e.__timeout||(e.__timeout=setTimeout((function(){e.popover("hide")}),250))}));var c=e.data("popover").tip().mouseenter((function(){e.__timeout&&(clearTimeout(e.__timeout),e.__timeout=null)}));c.find("img").unbind().click((function(){_.deleteNote(i)})),c.mouseleave((function(){e.__timeout=setTimeout((function(){e.popover("hide")}),250)}))}(e,t,i)}(this,t.note?t.note:ie[t.hash],t.hash)})),e.find(".add-note").unbind("mouseover").mouseover((function(){!function n(e,t){!function(e,t){e=$(e);try{e.data("popover").tip().remove(),e.removeData("popover")}catch(e){}function a0(){e.__timeout&&(clearTimeout(e.__timeout),e.__timeout=null)}console.log("addNotePopover()"),e.popover({title:'Add Note <span style="float:right"><i class="icon-remove-sign"></i></span>',trigger:"manual",content:'<textarea style="width:97%;height:50px;margin-top:2px" placeholder="Enter the note here..."></textarea><div style="text-align:right"><button class="btn btn-small">Save</button></div>'}),e.popover("show"),e.unbind("mouseleave").mouseleave((function(){e.__timeout||(e.__timeout=setTimeout((function(){e.popover("hide")}),250))}));var i=e.data("popover").tip().mouseenter(a0);i.find("textarea").focus(a0),i.mouseleave((function(){e.__timeout=setTimeout((function(){e.popover("hide")}),250)})),i.find("i").unbind().click((function(){e.popover("hide")})),i.find("button").click((function(){var e=$.trim(i.find("textarea").val());ai(e)?(e.length>0&&(ie[t]=e,_.backupWalletDelayed()),d()):_.makeNotice("error","misc-error","Note must be contain letters and numbers only")}))}(e,t)}(this,t.hash)})),e}function u(e,t){for(var i=0,r=0;r<e.inputs.length;++r){if((h=e.inputs[r].prev_out)&&h.addr)if(k=te[h.addr])i-=_=parseInt(h.value),t&&(O+=_,k.balance-=_)}for(var c=0;c<e.out.length;++c){var h,k,_;if((h=e.out[c])&&h.addr)if(k=te[h.addr])i+=_=parseInt(h.value),t&&(R+=_,k.balance+=_)}return i}function al(){return Crypto.util.bytesToHex(Crypto.SHA256(e,{asBytes:!0}))}function y(e){var i=null;e.onmessage=function(e){try{var t=$.parseJSON(e.data);if("on_change"==t.op){var r=al(),c=t.checksum;console.log("On change old "+r+" ==  new "+c),i!=c&&r!=c&&(i=c,K())}else if("utx"==t.op){var h=TransactionFromJSON(t.x);for(var k in Q)if(Q[k].txIndex==h.txIndex)return;var S=u(h,!0);if(_.getHTML5Notifications()&&_.showNotification({title:S>0?"Payment Received":"Payment Sent",body:"Transaction Value "+formatBTC(S),iconUrl:resource+"cube48.png"}),h.result=S,L+=S,F++,h.setConfirmations(0),playSound("beep"),0==X&&0==z){Q.unshift(h);var x=!1;Q.length>_.getNTransactionsPerPage()&&(Q.pop(),x=!0)}if(_.sendEvent("on_tx"),"my-transactions"==Y()){if(0==X&&0==z)if($("#no-transactions").hide(),0==ve.tx_display){var C=$("#transactions-compact").show();aT(D(h,te,J),h).prependTo(C.find("tbody")).find("div").hide().slideDown("slow"),x&&C.find("tbody tr:last-child").remove()}else{(C=$("#transactions-detailed").show()).prepend(h.getHTML(te,J)),x&&C.find("div:last-child").remove(),setupSymbolToggle()}}else d()}else if("block"==t.op){for(var P=0;P<t.x.txIndexes.length;++P)for(var N=0;N<Q.length;++N)if(Q[N].txIndex==t.x.txIndexes[P]&&(null==Q[N].blockHeight||0==Q[N].blockHeight)){Q[N].blockHeight=t.x.height;break}aB(BlockFromJSON(t.x)),_.sendEvent("on_block"),Z()}}catch(e){console.log(e),console.log(e.data)}},e.onopen=function(){_.sendEvent("ws_on_open"),ax("ok");var i='{"op":"blocks_sub"}';null!=t&&(i+='{"op":"wallet_sub","guid":"'+t+'"}');try{var r=_.getActiveAddresses();for(var c in r)i+='{"op":"addr_sub", "addr":"'+r[c]+'"}'}catch(e){alert(e)}e.send(i)},e.onclose=function(){_.sendEvent("ws_on_close"),ax("error")}}this.setEncryptedWalletData=function(t){if(!t||0==t.length)return e=null,void(x=null);e=t,x=al()},this.setRealAuthType=function(e){e},this.addAdditionalSeeds=function(e){ve.additional_seeds.length>=50&&(ve.additional_seeds=ve.additional_seeds.slice(ve.additional_seeds.length-49,ve.additional_seeds.length)),ve.additional_seeds.push(e)},this.getAdditionalSeeds=function(){return ve.additional_seeds},this.getLanguage=function(){return ce},this.setLanguage=function(e){MyStore.put("language",e),ce=e},this.addEventListener=function(e){re.push(e)},this.sendEvent=function(e,t){for(var i in re)re[i](e,t)},this.getLogoutTime=function(){return ve.logout_time},this.getSecondPasswordPbkdf2Iterations=function(){return ve.pbkdf2_iterations},this.getMainPasswordPbkdf2Iterations=function(){return oe},this.getSharedKey=function(){return k},this.getSharedcoinEndpoint=function(){return W},this.disableLogout=function(e){ue=e},this.getFinalBalance=function(){return L},this.getTotalSent=function(){return O},this.getTotalReceived=function(){return R},this.setLogoutTime=function(e){ve.logout_time=e,clearInterval(N),N=setTimeout(_.logout,_.getLogoutTime())},this.getDoubleEncryption=function(){return V},this.getEncryptedWalletData=function(){return e},this.getFeePolicy=function(){return ve.fee_policy},this.setFeePolicy=function(e){ve.fee_policy=parseInt(e)},this.setAlwaysKeepLocalBackup=function(e){ve.always_keep_local_backup=e},this.getAlwaysKeepLocalBackup=function(){return ve.always_keep_local_backup},this.setNTransactionsPerPage=function(e){ve.transactions_per_page=e},this.getNTransactionsPerPage=function(){return ve.transactions_per_page},this.getGuid=function(){return t},this.getHTML5Notifications=function(){return ve.html5_notifications},this.setHTML5Notifications=function(e){ve.html5_notifications=e},this.getNTransactions=function(){return F},this.getTransactions=function(){return Q},this.addressExists=function(e){return null!=te[e]},this.getAddressTag=function(e){return te[e].tag},this.setAddressTag=function(e,t){te[e].tag=t},this.getAddressBook=function(){return J},this.getAddressLabel=function(e){return te[e]?te[e].label:null},this.setAddressLabel=function(e,t){te[e].label=t},this.setAddressBalance=function(e,t){te[e].balance=t},this.getAddressBookLabel=function(e){return J[e]},this.isWatchOnly=function(e){return!te[e]||null==te[e].priv},this.getAddressBalance=function(e){return te[e].balance},this.getRecommendIncludeFee=function(){return ne},this.deleteAddress=function(e){delete te[e]},this.addAddressBookEntry=function(e,t){J[e]=t},this.getPrivateKey=function(e){return te[e].priv},this.setLabel=function(e,t){te[e].label=t,_.backupWalletDelayed(),d()},this.securePost=function(e,i,r,c){var h=jQuery.extend({},i);if(!i.sharedKey){if(!k||0==k.length||36!=k.length)throw"Shared key is invalid";var _=(new Date).getTime(),S=parseInt((_-de)/1e4),x=Crypto.SHA256(k.toLowerCase()+S),C=0,P=x.substring(C,C+=8)+"-"+x.substring(C,C+=4)+"-"+x.substring(C,C+=4)+"-"+x.substring(C,C+=4)+"-"+x.substring(C,C+=12);h.sharedKey=P,h.sKTimestamp=S,h.sKDebugHexHash=x,h.sKDebugTimeOffset=de,h.sKDebugOriginalClientTime=_,h.sKDebugOriginalSharedKey=k}i.guid||(h.guid=t),h.format=i.format?i.format:"plain";var N="text";"json"==i.format&&(N="json"),$.ajax({dataType:N,type:"POST",timeout:6e4,url:root+e,data:h,success:r,error:c})},this.isCorrectMainPassword=function(e){return r==e},this.setPbkdf2Iterations=function(e,t){var aZ=function(e){console.log("Panic "+e),window.location.reload()};_.getSecondPassword((function(){try{if(V){for(var i in te){var r=te[i];if(r.priv&&(r.priv=_.encrypt(_.decryptPK(r.priv),k+c,e),!r.priv))throw"addr.priv is null"}ve.pbkdf2_iterations=e,h=ah(k+c,e)}2,oe=e,_.backupWallet("update",(function(){t()}),(function(){aZ(a2)}))}catch(e){aZ(e)}}),(function(e){aZ(e)}))},this.setDoubleEncryption=function(e,t,i){var aZ=function(e){console.log("Panic "+e),window.location.reload()};try{if(V==e)return;e?_.getSecondPassword((function(){try{for(var e in V=!0,c=t,te){var r=te[e];if(r.priv&&(r.priv=j(B58.decode(r.priv)),!r.priv))throw"addr.priv is null"}h=ah(k+c,ve.pbkdf2_iterations),c=null,_.getSecondPassword((function(){try{_.checkAllKeys(),_.backupWallet("update",(function(){i()}),(function(){aZ(a6)}))}catch(e){aZ(e)}}),(function(e){aZ(e)}))}catch(e){aZ(e)}}),(function(e){aZ(e)})):_.getSecondPassword((function(){try{for(var e in te){var t=te[e];if(t.priv&&(t.priv=_.decryptPK(t.priv),!t.priv))throw"addr.priv is null"}V=!1,c=null,_.checkAllKeys(),_.backupWallet("update",(function(){i()}),(function(){aZ(a4)}))}catch(e){aZ(e)}}),(function(e){aZ(e)}))}catch(e){aZ(e)}},this.unArchiveAddr=function(e){2==(e=te[e]).tag?(e.tag=null,d(),_.backupWalletDelayed("update",(function(){_.get_history()}))):_.makeNotice("error","add-error","Cannot Unarchive This Address")},this.archiveAddr=function(e){_.getActiveAddresses().length<=1?_.makeNotice("error","add-error","You must leave at least one active address"):null==(e=te[e]).tag||0==e.tag?(e.tag=2,d(),_.backupWalletDelayed("update",(function(){_.get_history()}))):_.makeNotice("error","add-error","Cannot Archive This Address")},this.addWatchOnlyAddress=function(e){return aU(e)},this.addPrivateKey=function(e,t){if(function an(){if(aI(te)>=ee)return _.makeNotice("error","misc-error","We currently support a maximum of 1000 private keys, please remove some unused ones."),!0;return!1}())return!1;if(null==e)throw"Cannot add null key.";null==t&&(t={});var i=t.compressed?e.getBitcoinAddressCompressed().toString():e.getBitcoinAddress().toString(),r=j(e.priv);if(null==r)throw"Error Encoding key";var c=new Bitcoin.ECKey(_.decodePK(r));if(i!=c.getBitcoinAddress().toString()&&i!=c.getBitcoinAddressCompressed().toString())throw"Decoded Key address does not match generated address";if(!aU(i,r))throw"Unable to add generated private key.";if(te[i].tag=1,te[i].created_time=t.created_time?t.created_time:(new Date).getTime(),te[i].created_device_name=t.app_name?t.app_name:APP_NAME,te[i].created_device_version=t.app_version?t.app_version:APP_VERSION,te[i].priv!=r)throw"Address priv does not match encoded";try{ws.send('{"op":"addr_sub", "addr":"'+i+'"}')}catch(e){}return i},this._seed=function(e){var t=""+(new Date).getTime();r&&r.length>0&&(t+=r),e&&e.length>0&&(t+=e),E&&E.length>0&&(t+=E);var i=$("body").data("extra-seed");i&&i.length>0&&(t+=i);for(var c=[],h=0;c.length<rng_psize;)c=c.concat(Crypto.SHA256(t+h,{asBytes:!0})),++h;var k=Crypto.util.bytesToWords(c);seed_large_int32_array(k)},this.generateNewKey=function(e){_._seed(e);var t=new Bitcoin.ECKey(!1),i=_.addPrivateKey(t,{compressed:!0});if(i)return{key:t,addr:i}},this.setLoadingText=function(e){$(".loading-text").text(e)},$(window).resize((function(){$(".modal:visible").center(),M()}));var ye="ok";function ax(e){var t=$("#logout");"loading_start"!=e?("loading_stop"!=e&&(ye=e),"ok"==ye?t.attr("src",resource+"logout.png"):"error"==ye&&t.attr("src",resource+"logout-red.png")):t.attr("src",resource+"logout-orange.png")}function aJ(e){return e}function ay(e){return _.decryptPK(e)}function af(e){var t=_.decodePK(e);return Crypto.util.bytesToBase64(t)}function l(e){var t=_.decodePK(e);return Crypto.util.bytesToHex(t)}function m(e,t,i){var r=e.val();for(var c in e.empty(),te){var h=te[c];if(h&&2!=h.tag){var k=h.label;k||(k=h.addr.substring(0,15)+"..."),(t||h.balance>0)&&e.prepend('<option value="'+h.addr+'">'+k+" - "+formatBTC(h.balance)+"</option>")}}e.prepend('<option value="any" selected>Any Address</option>'),!i&&r&&e.val(r)}function s(e,t){m(e.find('select[name="from"]'),!1,t),m(e.find('select[name="change"]'),!0,t),e.find('select[name="change"]').prepend('<option value="new">New Address</option>'),e.find(".local-symbol").text(symbol_local.symbol),e.find(".btc-symbol").text(symbol_btc.symbol),t&&(e.find("input").val(""),e.find(".send-value-usd").text(formatSymbol(0,symbol_local)).val(""),e.find(".amount-needed").text(0));var i=e.find(".recipient-container");if(t){var r=i.find(".recipient:first-child").clone();i.empty().append(r)}function a3(t){t.find('input[name="send-to-address"]').typeahead({source:aE()}).next().unbind().click((function(){var e=$(this).prev();_.scanQRCode((function(i){console.log(i);try{new Bitcoin.Address(i),e.val(i)}catch(e){_.handleURI(i,t)}}),(function(e){_.makeNotice("error","misc-error",e)}))})),t.find(".send-value").unbind().bind("keyup change",(function(i){"9"!=i.keyCode&&(e.find(".amount-needed").text(formatBTC(function aZ(){var t=BigInteger.ZERO;return e.find(".send-value").each((function(){t=t.add(precisionToSatoshiBN($(this).val()))})),t}().toString())),t.find(".send-value-usd").val(convert($(this).val()*symbol_btc.conversion,symbol_local.conversion)).text(formatSymbol($(this).val()*symbol_btc.conversion,symbol_local)))})),t.find(".send-value-usd").text(formatSymbol(0,symbol_local)).unbind().bind("keyup change",(function(e){"9"!=e.keyCode&&t.find(".send-value").val(formatSatoshi(parseFloat($(this).val())*symbol_local.conversion,sShift(symbol_btc),!0))}))}i.find(".recipient").each((function(){a3($(this))})),e.find(".remove-recipient").unbind().click((function(){var e=i.find(".recipient").length;e>1&&(2==e&&$(this).hide(200),i.find(".recipient:last-child").remove())})),e.find(".add-recipient").unbind().click((function(){var t=i.find(".recipient:first-child").clone();t.find('input[type="text"]').val(""),t.appendTo(i),a3(t),e.find(".remove-recipient").show(200)}));var c=e.find('select[name="from"]');0==c.length?e.find(".amount-available").text(formatBTC(L)):c.unbind().change((function(){var t=0,i=$(this).val();for(var r in i){if("any"==i[r]){$(this).val("any"),t=L;break}var c=te[i[r]];c&&c.balance&&(t+=c.balance)}e.find(".amount-available").text(formatBTC(t))})).trigger("change")}function aB(e){if(null!=e){for(var t in S=e,Q){var i=Q[t];if(null!=i.blockHeight&&i.blockHeight>0)S.height-i.blockHeight+1<=100?i.setConfirmations(S.height-i.blockHeight+1):i.setConfirmations(null);else i.setConfirmations(0)}_.sendEvent("did_set_latest_block")}}function ai(e){return/^[\w\-,._  @\+]+$/.test(e)}function D(e,t,i){var r=e.result,c=$('<tr class="pointer"></tr>');c.attr("id","tx-"+e.txIndex);var h=$('<td class="hidden-phone" style="width:365px"></td>');c.append(h);var k=$('<div style="margin-left:0px;margin-bottom:9px;" class="short-addr"></div>');h.append(k);var _=!0;if(r>=0)if(e.inputs.length>5)_=!1,k.append('<span class="label">Many Inputs</span>');else for(var S=0;S<e.inputs.length;++S){if(x=e.inputs[S].prev_out)if(x.addr){if(t[x.addr])continue;_=!1,k.append(formatOutput(x,t,i))}else _=!1,k.append('<span class="label">Unknown Address</span>');else{if(_=!1,1==e.inputs.length){k.append('<span class="label">Newly Generated Coins</span>');break}k.append('<span class="label">Missing Outpoint</span>')}}else if(r<0)if(e.out.length>5)_=!1,k.append('<span class="label">Many Outputs</span>');else for(S=0;S<e.out.length;++S){var x;if((x=e.out[S]).addr){if(t[x.addr]&&0==x.type)continue;_=!1,k.append(formatOutput(x,t,i))}else _=!1,k.append('<span class="label">Unknown Address</span>')}_&&k.append('<span class="label">Moved Between Wallet</info>');h=$("<td></td>");c.append(h);k=$("<div></div>");if(h.append(k),(e.note?e.note:ie[e.hash])?k.append('<img src="'+resource+'note.png" class="show-note"> '):k.append('<img src="'+resource+'note_grey.png" class="add-note"> '),e.time>0&&k.append(dateToString(new Date(1e3*e.time))+" "),0==e.confirmations||e.confirmations>0){var C=$('<span class="label hidden-phone"></span>');0==e.confirmations?(C.addClass("label-important"),C.text("Unconfirmed Transaction!")):e.confirmations>0&&(C.addClass("label-info"),C.text(e.confirmations+" Confirmations")),k.append(C)}h=$("<td>"+formatMoney(r,!0)+"</td>");c.append(h),r>0?h.css({color:"green"}):r<0&&h.css({color:"red"});h=$('<td class="hidden-phone"></td>');return c.append(h),null!=e.balance&&h.append("<div>"+formatMoney(e.balance)+"</div>"),c}function Y(){return M(),null==L?$("#balance").html("Loading..."):($("#balance").html(formatSymbol(L,symbol,!0)),$("#balance2").html(formatSymbol(L,symbol===symbol_local?symbol_btc:symbol_local),!0)),i.attr("id")}function d(e){var t=Y();"send-coins"==t?function v(e){$("#send-coins").find(".tab-pane.active").trigger("show",e),e&&(BlockchainAPI.get_ticker(),$(".send").prop("disabled",!1))}(e):"home-intro"==t?function f(e){$("#summary-n-tx").html(F),$("#summary-received").html(formatMoney(R,!0)),$("#summary-sent").html(formatMoney(O,!0)),$("#summary-balance").html(formatMoney(L,symbol)),$(".paper-wallet-btn").unbind().click((function(){loadScript("wallet-legacy/paper-wallet",(function(){PaperWallet.showModal()}))}));var t=_.getPreferredAddress();if(null==t)return;if(_.isWatchOnly(t))$(".no-watch-only").hide();else{$(".no-watch-only").show();var i=$("#my-primary-address");i.text()!=t&&(i.text(t),loadScript("wallet-legacy/jquery.qrcode",(function(){$("#my-primary-addres-qr-code").empty().qrcode({width:125,height:125,text:t})})))}$("#tweet-for-btc").unbind().click((function(){_.openWindow("https://twitter.com/share?url=https://blockchain.info/wallet&hashtags=tweet4btc,bitcoin,"+t+"&text=Sign Up For a Free Bitcoin Wallet @ Blockchain.info")}))}():"receive-coins"==t?function aX(){$("#receive-coins").find(".tab-pane.active").trigger("show"),setupToggle()}():"my-transactions"==t&&Z()}function Z(){var e,t=null,i=0;if(null!=t&&(clearInterval(t),t=null),0==ve.tx_display?($("#transactions-detailed").hide(),e=$("#transactions-compact").show().find("tbody").empty()):($("#transactions-compact").hide(),e=$("#transactions-detailed").empty().show()),0==Q.length)return $("#transactions-detailed, #transactions-compact").hide(),void $("#no-transactions").show();$("#no-transactions").hide();var a0=function(){for(var r=i;r<Q.length&&r<i+_.getNTransactionsPerPage();++r){var c=Q[r];0==ve.tx_display?e.append(aT(D(c,te,J),c)):e.append(c.getHTML(te,J))}if((i+=_.getNTransactionsPerPage())<Q.length)t=setTimeout(a0,15);else{setupSymbolToggle(),M();var h=$(".pagination ul").empty();if(0==z&&Q.length<_.getNTransactionsPerPage())return void h.hide();h.show();var k=Math.ceil(H/_.getNTransactionsPerPage()),S=" disabled";z>0&&(S="");var x=Math.max(0,Math.min(z-5,k-10));h.append($('<li class="prev'+S+'"><a>&larr; Previous</a></li>').click((function(){_.setPage(z-1)}))),x>0&&h.append($("<li><a>≤</a></li>").click((function(){_.setPage(0)})));for(r=x;r<k&&r<x+10;++r)!function(e){var t="";z==e&&(t=' class="active"'),h.append($("<li"+t+'><a class="hidden-phone">'+(e+1)+"</a></li>").click((function(){_.setPage(e)})))}(r);x+10<k&&h.append($("<li><a>≥</a></li>").click((function(){_.setPage(k-1)})));S=" disabled";z<k-1&&(S=""),h.append($('<li class="next'+S+'"><a>Next &rarr;</a></li>').click((function(){_.setPage(z+1)})))}};a0()}function I(e,t){if(t||(ne=e.recommend_include_fee,e.info&&(e.info.symbol_local&&setLocalSymbol(e.info.symbol_local),e.info.symbol_btc&&setBTCSymbol(e.info.symbol_btc),e.info.notice&&_.makeNotice("error","misc-error",e.info.notice))),W=e.sharedcoin_endpoint,Q.length=0,null==e.wallet)return R=0,O=0,L=0,F=0,void(H=0);R=e.wallet.total_received,O=e.wallet.total_sent,L=e.wallet.final_balance,F=e.wallet.n_tx,H=e.wallet.n_tx_filtered;for(var i=0;i<e.addresses.length;++i)te[e.addresses[i].address]&&(te[e.addresses[i].address].balance=e.addresses[i].final_balance);for(i=0;i<e.txs.length;++i){var r=TransactionFromJSON(e.txs[i]);r.result=u(r,!1),Q.push(r)}t||e.info.latest_block&&aB(e.info.latest_block),_.sendEvent("did_multiaddr")}function aP(){K(),N=setTimeout(_.logout,_.getLogoutTime()),_.sendEvent("did_decrypt"),_.get_history(null,(function(){MyStore.get("multiaddr",(function(e){null!=e&&(I($.parseJSON(e),!0),d())}))})),$("#initial_error,#initial_success").remove();var e=decodeURIComponent(window.location.hash.replace("#",""));if(0==e.indexOf("bitcoin:")){var t=$("#send-coins");aj(t);var i=t.find(".tab-pane.active").find(".recipient").first();_.handleURI(e,i)}else aj($("#home-intro"));window.location.hash=""}function K(e,t){var i={method:"wallet.aes.json",format:"json"};x&&x.length>0&&(i.checksum=x),_.setLoadingText("Checking For Wallet Updates"),_.securePost("wallet",i,(function(i){if(i.storage_token&&(null!=me&&-1!=me.indexOf(i.storage_token)||MyStore.put("storage_token",(me?me+"|":"")+i.storage_token)),i.payload&&"Not modified"!=i.payload){var r;try{r=$.parseJSON(i.payload)}catch(e){}if(r&&r.version&&r.version>=3){var c=_.getGuid();return null==c&&(c=""),void(window.location=root+"wallet/#/login/"+c)}_.setEncryptedWalletData(i.payload),ae((function(){_.get_history(),d(),e&&e()}),(function(){t&&t()}))}else e&&e()}),(function(e){t&&t()}))}function ae(t,i){null!=e&&0!=e.length?_.decryptWallet(e,r,(function(e,r){try{if(!(k=e.sharedKey)||0==k.length||36!=k.length)throw"Shared Key is invalid";r&&(r.version,oe=r.pbkdf2_iterations),e.double_encryption&&e.dpasswordhash&&(V=e.double_encryption,h=e.dpasswordhash),e.options&&($.extend(ve,e.options),ve.additional_seeds.length>=50&&(ve.additional_seeds=ve.additional_seeds.slice(ve.additional_seeds.length-50,ve.additional_seeds.length))),te={};for(var c=0;c<e.keys.length;++c){var S=e.keys[c];S.addr&&ai(S.addr)?(1!=S.tag&&ai(S.tag)||(S.tag=null),S.label&&!ai(S.label)&&(S.label=null),te[S.addr]=S):_.makeNotice("error","null-error","Your wallet contains an invalid address. This is a sign of possible corruption, please double check all your BTC is accounted for. Backup your wallet to remove this error.",15e3)}if(J={},e.address_book)for(c=0;c<e.address_book.length;++c){var C=e.address_book[c];C.label&&ai(C.label)&&ai(C.addr)&&_.addAddressBookEntry(C.addr,C.label)}if(e.hd_wallets&&(ge=e.hd_wallets),e.tx_notes)for(var P in e.tx_notes){var N=e.tx_notes[P];N&&ai(N)&&(ie[P]=N)}null!=x&&0!=x.length||(x=al()),function a(){if(se)return;ax("error"),webSocketConnect(y),se=!0,$("#tech-faq").hide(),$("#intro-text").hide(),$("#large-summary").show()}(),t()}catch(e){i(e)}}),i):i("No Wallet Data To Decrypt")}function j(e){return function aQ(e){if(V){if(null==c)throw"Cannot encrypt private key without a password";return _.encrypt(e,k+c,_.getSecondPasswordPbkdf2Iterations())}return e}(B58.encode(e))}function aj(e){e!==i&&(null!=i&&($("#"+i.attr("id")+"-btn").length>0&&$("#"+i.attr("id")+"-btn").parent().attr("class",""),i.hide()),(i=e).show(),$("#"+i.attr("id")+"-btn").length>0&&$("#"+i.attr("id")+"-btn").parent().attr("class","active"),d(!0))}function aI(e){var t,i=0;for(t in e)i++;return i}function ag(e){te[e].priv=null}function aU(e,t){var i=te[e];return i&&0!=i.length?!(i.priv||!t)&&(i.priv=t,!0):(te[e]={addr:e,priv:t,balance:0},!0)}function aE(){var e=[];for(var t in J)e.push(J[t]);for(var t in te){var i=te[t];2!=i.tag&&i.label&&e.push(i.label)}return e}function aG(){try{$(".pop").popover({offset:10,placement:"bottom"})}catch(e){}}function o(){fe||(fe=!0,$("#add-address-book-entry-btn").click((function(){!function p(){var e=$("#add-address-book-entry-modal");e.modal({keyboard:!0,backdrop:"static",show:!0});var t=e.find('input[name="label"]'),i=e.find('input[name="address"]');t.val(""),i.val(""),e.find(".btn.btn-primary").unbind().click((function(){e.modal("hide");var r=$.trim(t.val()),c=$.trim(i.val());if(0==r.length||0==c.length)return _.makeNotice("error","misc-error","You must enter an address and label for the address book entry"),!1;if(!ai(r)||!ai(c))return _.makeNotice("error","misc-error","Label and Bitcoin Address must contain letters and numbers only"),!1;try{if(null==new Bitcoin.Address(c))throw"Null address"}catch(e){return _.makeNotice("error","misc-error","Bitcoin address invalid, please make sure you entered it correctly"),!1}if(null!=J[c])return _.makeNotice("error","misc-error","Bitcoin address already exists"),!1;_.makeNotice("success","misc-success","Added Address book entry"),_.addAddressBookEntry(c,r),_.backupWalletDelayed(),$("#send-coins").find(".tab-pane").trigger("show",!0)})),e.find(".btn.btn-secondary").unbind().click((function(){e.modal("hide")}))}()})),$("#home-intro-btn").click((function(){aj($("#home-intro"))})),$("#my-transactions-btn").click((function(){aj($("#my-transactions"))})),$("#send-coins-btn").click((function(){aj($("#send-coins"))})),$("#import-export-btn").click((function(){aj($("#import-export")),function U(){var e=$("#export-warning").show(),t=$("#import-export-content").hide();$("#show-import-export").unbind().click((function(){_.getMainPassword((function(){e.hide(),loadScript("wallet-legacy/import-export",(function(){ImportExport.init(t,(function(){t.show()}),(function(){aj($("#home-intro"))}))}),(function(e){_.makeNotice("error","misc-error",e),aj($("#home-intro"))}))}),(function(){aj($("#home-intro"))}))}))}()})),$("#chord-diagram").click((function(){loadScript("wallet-legacy/frame-modal",(function(){showFrameModal({title:"Address Relationships",description:"",src:root+"taint/"+_.getActiveAddresses().join("|")})}))})),$("#verify-message").click((function(){loadScript("wallet-legacy/address_modal",(function(){verifyMessageModal()}))})),$("#generate-cold-storage").click((function(){loadScript("wallet-legacy/paper-wallet",(function(){PaperWallet.showColdStorageModal()}),null,!0)})),$("#group-received").click((function(){loadScript("wallet-legacy/taint_grouping",(function(){try{loadTaintData()}catch(e){_.makeNotice("error","misc-error","Unable To Load Taint Grouping Data")}}))})),$("#my-account-btn").click((function(){aj($("#my-account"));var e=$("#account-settings-warning").show(),t=$("#my-account-content").hide();$("#show-account-settings").unbind().click((function(){_.getMainPassword((function(){e.hide(),loadScript("wallet-legacy/account",(function(){AccountSettings.init(t,(function(){t.show()}),(function(){aj($("#home-intro"))}))}),(function(e){_.makeNotice("error","misc-error",e),aj($("#home-intro"))}))}),(function(){aj($("#home-intro"))}))}))})),$("#active-addresses").on("show",(function(){var e=$(this).find("table:first");e.find("tbody:gt(0)").remove();e.find("tbody").empty();for(var t in te){var i=te[t];if(2!=i.tag&&1!=i.tag){var r="";1==i.tag?r=' <font color="red" class="pop" title="Not Synced" data-content="This is a new address which has not yet been synced with our the server. Do not used this address yet.">(Not Synced)</font>':null==i.priv&&(r=' <font color="red" class="pop" title="Watch Only" data-content="Watch Only means there is no private key associated with this bitcoin address. <br /><br /> Unless you have the private key stored elsewhere you do not own the funds at this address and can only observe the transactions.">(Watch Only)</font>');var c="",h=i.addr;null!=i.label&&(h=i.label,c='<span class="hidden-phone"> - '+i.addr+"</span>");var k=$('<tr><td><div class="short-addr"><a href="'+root+"address/"+i.addr+'" target="new">'+h+"</a>"+c+" "+r+'<div></td><td><span style="color:green">'+formatMoney(i.balance,!0)+'</span></td>            <td><div class="btn-group pull-right"><a class="btn btn-mini dropdown-toggle" data-toggle="dropdown" href="#"><span class="hidden-phone">Actions </span><span class="caret"></span></a><ul class="dropdown-menu">             <li><a href="#" class="pop act-archive" title="Archive Address" data-content="Click this button to hide the address from the main view. You can restore or delete later by finding it in the Archived addresses tab.">Archive Address</a></li>            <li><a href="#" class="pop act-label" title="Label Address" data-content="Set the label for this address.">Label Address</a></li>            <li><a href="#" class="pop act-qr" title="Show QR Code" data-content="Show a QR Code for this address.">QR Code</a></li>            <li><a href="#" class="pop act-sign" title="Sign Message" data-content="Sign A message with this address.">Sign Message</a></li>            <li><a href="#" class="pop act-request" title="Request Payment" data-content="Click here to create a new QR Code payment request. The QR Code can be scanned using most popular bitcoin software and mobile apps.">Create Payment Request</a></li>            <li><a href="#" class="pop act-pubkey">Show Public Key</a></li>            </ul></div></td></tr>');!function(e){k.find(".act-archive").click((function(){_.archiveAddr(e)})),k.find(".act-label").click((function(){loadScript("wallet-legacy/address_modal",(function(){showLabelAddressModal(e)}))})),k.find(".act-qr").click((function(){loadScript("wallet-legacy/address_modal",(function(){showAddressModalQRCode(e)}))})),k.find(".act-pubkey").click((function(){_.getSecondPassword((function(){var t=_.getPrivateKey(e);if(null!=t){var i=new Bitcoin.ECKey(_.decodePK(t));if(i.getBitcoinAddressCompressed().toString()==e)var r=i.getPubCompressed();else r=i.getPub();_.makeNotice("success","pub-key","Public Key of "+e+" is "+Crypto.util.bytesToHex(r),2e4)}else _.makeNotice("eror","misc-error","Public Key Unknown")}))})),k.find(".act-sign").click((function(){loadScript("wallet-legacy/address_modal",(function(){showAddressModalSignMessage(e)}))})),k.find(".act-request").click((function(){loadScript("wallet-legacy/frame-modal",(function(){showFrameModal({title:"Create Payment Request",description:"Request Payment into address <b>"+e+"</b>",src:root+"payment_request?address="+e})}))}))}(i.addr),i.balance>0&&i.priv?e.prepend(k):e.append(k)}}aG()})),$("#archived-addresses").on("show",(function(){$("#archived-addr tbody").empty();var e=$(this).find("tbody"),t=_.getArchivedAddresses(),a0=function(){for(var i in e.empty(),t){var r=te[t[i]];if(2==r.tag&&1!=r.tag){var c="";null==r.priv&&(c=' <font color="red">(Watch Only)</font>');var h="",k=r.addr;null!=r.label&&(k=r.label,h='<span class="hidden-phone"> - '+r.addr+"</span>");var S=$('<tr><td style="width:20px;"><input type="checkbox" class="archived_checkbox" value="'+r.addr+'"></td><td><div class="short-addr"><a href="'+root+"address/"+r.addr+'" target="new">'+k+"</a>"+h+" "+c+'<div></td><td><span style="color:green">'+formatBTC(r.balance)+'</span></td><td style="width:16px"><img src="'+resource+'unarchive.png" class="act-unarchive" /></td></tr>');!function(e){S.find(".act-unarchive").click((function(){_.unArchiveAddr(e)}))}(r.addr),r.balance>0&&r.priv?e.prepend(S):e.append(S)}}};a0(),BlockchainAPI.get_balances(t,(function(e){a0()}),(function(e){_.makeNotice("error","misc-error",e)}))})),$("#archived-select-all").click((function(){$(".archived_checkbox").prop("checked",!0)})),$("#archived-select-none").click((function(){$(".archived_checkbox").prop("checked",!1)})),$("#archived-sweep").click((function(){var e=[];$(".archived_checkbox:checked").each((function(){var t=te[$(this).val()];null!=t.priv?e.push(t.addr):_.makeNotice("error","misc-error","Cannot Sweep Watch Only Address")})),0!=e.length&&_.sweepAddressesModal(e)})),$("#archived-delete").click((function(){var e=[];$(".archived_checkbox:checked").each((function(){e.push($(this).val())})),0!=e.length&&function ar(e){var t=$("#delete-address-modal");t.modal({keyboard:!0,backdrop:"static",show:!0}),t.find(".btn.btn-primary").hide(),t.find(".btn.btn-danger").hide(),$("#change-mind").hide(),t.find("#to-delete-address").html(e.join(" ")),t.find("#delete-balance").empty();var i=t.find("#delete-balance"),r=[];for(var c in e){var h=e[c];te[h]&&te[h].priv&&r.push(e[c])}BlockchainAPI.get_balance(r,(function(e){t.find(".btn.btn-primary").show(200),t.find(".btn.btn-danger").show(200),i.html("Balance "+formatBTC(e)),e>0?i.css("color","red"):i.css("color","black")}),(function(){t.find(".btn.btn-primary").show(200),t.find(".btn.btn-danger").show(200),i.text("Error Fetching Balance")}));var k=!1,S=(c=0,null);changeMind=function(){$("#change-mind").show(),$("#change-mind-time").text(10-c)},t.find(".btn.btn-primary").unbind().click((function(){changeMind(),t.find(".btn.btn-primary").hide(),t.find(".btn.btn-danger").hide(),S=setInterval((function(){if(!k&&(++c,changeMind(),10==c)){for(var t in $("#delete-address-modal").modal("hide"),_.makeNotice("warning","warning-deleted","Private Key Removed From Wallet"),e)ag(e[t]);d(),_.backupWallet(),clearInterval(S)}}),1e3)})),t.find(".btn.btn-danger").unbind().click((function(){changeMind(),t.find(".btn.btn-primary").hide(),t.find(".btn.btn-danger").hide(),S=setInterval((function(){if(!k&&(++c,changeMind(),10==c))try{for(var t in $("#delete-address-modal").modal("hide"),_.makeNotice("warning","warning-deleted","Address & Private Key Removed From Wallet"),e)_.deleteAddress(e[t]);d(),_.backupWallet("update",(function(){_.get_history()}))}finally{clearInterval(S)}}),1e3)})),t.unbind().on("hidden",(function(){S&&(k=!0,clearInterval(S),S=null)})),t.find(".btn.btn-secondary").unbind().click((function(){t.modal("hide")}))}(e)})),$("#shared-never-ask").click((function(){SetCookie("shared-never-ask",$(this).is(":checked"))})),$(".deposit-btn").click((function(){var e=$(this),i=_.getPreferredAddress(),r=e.data("extra");null==r&&(r=""),loadScript("wallet-legacy/frame-modal",(function(){showFrameModal({title:e.data("title"),description:"Deposit into address <b>"+i+"</b>",top_right:'Have Questions? Read <a href="'+e.data("link")+'" target="new">How It Works</a>',src:root+"deposit?address="+i+"&ptype="+e.data("type")+"&guid="+t+r})}))})),$(".withdraw-btn").click((function(){var e=$(this);_.getSecondPassword((function(){var i=_.getPreferredAddress();loadScript("wallet-legacy/frame-modal",(function(){showFrameModal({title:e.data("title"),description:"Your Wallet Balance is <b>"+formatBTC(L)+"</b>",src:root+"withdraw?method="+e.data("type")+"&address="+i+"&balance="+L+"&guid="+t})}))}))})),$("#logout").click(_.logout),$("#refresh").click((function(){K((function(){_.get_history()}))})),$("#summary-n-tx-chart").click((function(){loadScript("wallet-legacy/frame-modal",(function(){showFrameModal({title:"Number of transactions",description:"",src:root+"charts/n-transactions?show_header=false&address="+_.getActiveAddresses().join("|")})}))})),$("#summary-received-chart").click((function(){loadScript("wallet-legacy/frame-modal",(function(){showFrameModal({title:"BTC Received Per Day",description:"",src:root+"charts/received-per-day?show_header=false&address="+_.getActiveAddresses().join("|")})}))})),$("#summary-balance-chart").click((function(){loadScript("wallet-legacy/frame-modal",(function(){showFrameModal({title:"Wallet Balance",description:"",src:root+"charts/balance?show_header=false&address="+_.getActiveAddresses().join("|")})}))})),$("#new-addr").click((function(){$("#new-addr").prop("disabled",!0),K((function(){_.getSecondPassword((function(){var e=_.generateNewKey();if(!e||!e.addr)throw $("#new-addr").removeAttr("disabled"),"Error Generating New Address";var t=e.addr;_.backupWallet("update",(function(){_.makeNotice("info","new-address","Generated new Bitcoin Address "+t),$("#new-addr").removeAttr("disabled"),loadScript("wallet-legacy/address_modal",(function(){showLabelAddressModal(t)})),_.get_history()}),(function(){$("#new-addr").removeAttr("disabled")}))}),(function(){_.logout()}))}),(function(){$("#new-addr").removeAttr("disabled")}))})),$(".tx_filter a").click((function(){z=0,X=$(this).data("value"),_.get_history()})),$(".tx_display a").click((function(){var e=$(this).data("value");"export"!=e?(ve.tx_display=e,d(),_.backupWalletDelayed()):function w(){loadScript("wallet-legacy/frame-modal",(function(){showFrameModal({title:"Export History",description:"",src:root+"export-history?active="+_.getActiveAddresses().join("|")+"&archived="+_.getArchivedAddresses().join("|")})}))}()})),$("#email-backup-btn").click((function(){!function G(){_.setLoadingText("Sending email backup"),_.securePost("wallet",{method:"email-backup"},(function(e){_.makeNotice("success","backup-success",e)}),(function(e){_.makeNotice("error","misc-error",e.responseText)}))}()})),$("#dropbox-backup-btn").click((function(){_.openWindow(root+"wallet-legacy/dropbox-login?guid="+t)})),$("#gdrive-backup-btn").click((function(){_.openWindow(root+"wallet-legacy/gdrive-login?guid="+t)})),$("#balance").click((function(){toggleSymbol(),d()})),$("#send-quick").on("show",(function(e,t){var i=$(this);s(i,t),i.find(".send").unbind().click((function(){loadScript("wallet-legacy/signer",(function(){startTxUI(i,"quick",initNewTx())}))}))})),$("#send-email").on("show",(function(e,t){var i=$(this);s(i,t),i.find(".send").unbind().click((function(){loadScript("wallet-legacy/signer",(function(){startTxUI(i,"email",initNewTx())}))}))})),$("#send-custom").on("show",(function(e,t){var i=$(this);s(i,t),i.find(".send").unbind().click((function(){var e=!1;i.find('textarea[name="public-note"]').val()&&i.find(".send-value").each((function(){if($(this).val()<1e-4)return _.makeNotice("error","misc-error","You cannot attach a note to a transaction with an output size less than 0.0001 BTC"),e=!0,!1})),e||loadScript("wallet-legacy/signer",(function(){startTxUI(i,"custom",initNewTx())}))})),i.find('input[name="fees"]').unbind().bind("keyup change",(function(e){"9"!=e.keyCode&&$(this).parent().find(".send-value-usd").val(convert($(this).val()*symbol_btc.conversion,symbol_local.conversion)).text(formatSymbol($(this).val()*symbol_btc.conversion,symbol_local))})),i.find(".reset").unbind().click((function(){s(i,!0),i.find('select[name="from"]').trigger("change")}))})),$("#shared-coin").on("show",(function(e,t){var i=$(this);loadScript("wallet-legacy/sharedcoin",(function(){try{s(i),SharedCoin.init(i)}catch(e){console.log(e),_.makeNotice("error","misc-error",e)}}),(function(e){_.makeNotice("error","misc-error",e)}))})),$("#send-sms").on("show",(function(e,t){if(!t){var i=$(this);s(i),$.ajax({type:"GET",timeout:6e4,url:resource+"wallet-legacy/country_codes.html",success:function(e){i.find('select[name="sms-country-code"]').html(e)},error:function(){_.makeNotice("error","misc-error","Error Downloading SMS Country Codes")}}),i.find(".send").unbind().click((function(){loadScript("wallet-legacy/signer",(function(){var e=initNewTx();startTxUI(i,"sms",e)}))}))}})),$("#address-book").on("show",(function(){var e=$("#address-book-tbl tbody");if(aI(J)>0)for(var t in e.empty(),J){var i=$("<tr><td>"+J[t]+'</td><td><div class="addr-book-entry">'+t+'</div></td><td style="width:16px" class="hidden-phone"><img src="'+resource+'delete.png" class="act-delete" /></td></tr>');!function(e){i.find(".act-delete").click((function(){_.deleteAddressBook(e)}))}(t),e.append(i)}})),$('a[data-toggle="tab"]').unbind().on("show",(function(e){$(e.target.hash).trigger("show")})),$("#receive-coins-btn").click((function(){aj($("#receive-coins"))})),$("#cash-into-coins").click((function(){$(this).attr("href",$(this).attr("href")+_.getPreferredAddress())})),$(".show_adv").click((function(){$(".modal:visible").center()})),$(".download-backup-btn").show(),aG())}function q(){$(".resend-code").click((function(){_.setGUID(t,!0)})),$("#reset-two-factor-btn").click((function(){_.openWindow(root+"wallet-legacy/reset-two-factor"+(t?"?guid="+t:""))})),$(".recover-wallet-btn").click((function(){_.openWindow(root+"wallet-legacy/forgot-password"+(t?"?guid="+t:""))})),$(".download-backup-btn").toggle(null!=e).click((function(){if(e){try{var t=!!new Blob}catch(e){}if(t)loadScript("wallet-legacy/filesaver",(function(){var t=new Blob([e],{type:"text/plain;charset=utf-8"});saveAs(t,"wallet.aes.json")}));else window.open(null,null,"width=700,height=800,toolbar=0").document.write('<!DOCTYPE html><html><head></head><body><div style="word-wrap:break-word;" >'+e+"</div></body></html>");!function aV(){var e=$("#restore-backup-modal");e.modal({keyboard:!0,backdrop:"static",show:!0}),e.find(".btn.btn-secondary").unbind().click((function(){e.modal("hide")}))}()}else _.makeNotice("error","error","No Wallet Data to Download")})),$(".auth-0,.auth-1,.auth-2,.auth-3,.auth-4,.auth-5").unbind().keypress((function(e){13==e.keyCode&&(e.preventDefault(),$("#restore-wallet-continue").click())})),$("#restore-wallet-continue").unbind().click((function(i){i.preventDefault();var c=$.trim($("#restore-guid").val());0!=c.length&&(t!=c?(k=null,_.setGUID(c,!1)):function b(){if(!se&&!pe)try{pe=!0;var i=$("#restore-password");if(r=i.val(),i.val(""),B=(new Date).getTime(),null==e||0==e.length){_.setLoadingText("Validating Authentication key");var c=$.trim($(".auth-"+P).find(".code").val());if(0==c.length||c.length>255)throw"You must enter a Two Factor Authentication code";var h={guid:t,payload:c,length:c.length,method:"get-wallet",format:"plain"};me&&(h.storageToken=me),$.ajax({timeout:6e4,type:"POST",url:root+"wallet",data:h,success:function(e){try{if(null==e||0==e.length)throw"Server Return Empty Wallet Data";"Not modified"!=e&&_.setEncryptedWalletData(e),$(".auth-"+P).hide(),$(".auth-0").show(),ae((function(){pe=!1,o(),aP()}),aZ)}catch(e){aZ(e)}},error:function(e){aZ(e.responseText)}})}else ae((function(){pe=!1,o(),aP()}),aZ)}catch(e){aZ(e)}function aZ(e){pe=!1,_.makeNotice("error","misc-error",e),_.sendEvent("error_restoring_wallet")}}())})),$(".modal").on("show",(function(){M(),$(this).center()})).on("hidden",(function(){var e=$(".modal:visible"),t=$("#notices").remove();e.length>0?e.find(".modal-body").prepend(t):$("#main-notices-container").append(t)})).on("shown",(function(){M();var e=$(this);setTimeout((function(){e.is(":visible")&&e.find(".modal-body").prepend($("#notices").remove())}),100),e.center()}))}this.showNotification=function(e,t){try{var i;window.webkitNotifications&&0==webkitNotifications.checkPermission()?(i=webkitNotifications.createNotification(e.iconUrl,e.title,e.body)).show():window.Notification&&"granted"==window.Notification.permissionLevel()&&(i=new window.Notification(e.title,e).show()),i&&setTimeout((function(){i.cancel()}),t||5e3)}catch(e){}},this.makeNotice=function(e,t,i,r){if(null!=i&&0!=i.length){console.log(i);var c,h=$('<div class="alert alert-block alert-'+e+'"></div>');if(h.text(""+i),$("#"+t).length>0)h.attr("id",t);else $("#notices").append(h).hide().fadeIn(200),c=h,setTimeout((function(){c.fadeOut(250,(function(){$(this).remove()}))}),r||5e3)}},this.pkBytesToSipa=function(e,t){for(var i=new Bitcoin.ECKey(e);e.length<32;)e.unshift(0);if(e.unshift(128),i.getBitcoinAddress().toString()==t);else{if(i.getBitcoinAddressCompressed().toString()!=t)throw"Private Key does not match bitcoin address"+t;e.push(1)}var r=Crypto.SHA256(Crypto.SHA256(e,{asBytes:!0}),{asBytes:!0});return e=e.concat(r.slice(0,4)),B58.encode(e)},this.base58ToSipa=function(e,t){return _.pkBytesToSipa(_.decodePK(e),t)},this.makeWalletJSON=function(e){return _.makeCustomWalletJSON(e,t,k)},this.makeCustomWalletJSON=function(e,t,i){var r=aJ;"base64"==e?r=af:"hex"==e?r=l:"sipa"==e?r=_.base58ToSipa:"base58"==e&&(r=ay);var c='{\n\t"guid" : "'+t+'",\n\t"sharedKey" : "'+i+'",\n';for(var k in V&&null!=h&&r==aJ&&(c+='\t"double_encryption" : '+V+',\n\t"dpasswordhash" : "'+h+'",\n'),ve&&(c+='\t"options" : '+JSON.stringify(ve)+",\n"),c+='\t"keys" : [\n',te){var S=$.extend({},te[k]);for(var x in 1==S.tag&&delete S.tag,null!=S.priv&&(S.priv=r(S.priv,S.addr)),S)null!==S[x]&&void 0!==S[x]||delete S[x];delete S.balance,c+=JSON.stringify(S)+",\n",atLeastOne=!0}if(atLeastOne&&(c=c.substring(0,c.length-2)),c+="\n\t]",aI(J)>0){for(var k in c+=',\n\t"address_book" : [\n',J)c+='\t{"addr" : "'+k+'",\n',c+='\t "label" : "'+J[k]+'"},\n';c=c.substring(0,c.length-2),c+="\n\t]"}return ge&&(c+=',\n "hd_wallets" : '+JSON.stringify(ge)),aI(ie)>0&&(c+=',\n\t"tx_notes" : '+JSON.stringify(ie)),c+="\n}"},this.get_history=function(e,t){BlockchainAPI.get_history((function(t){I(t,!1),0==Q.length&&z>0?_.setPage(0):d(),e&&e()}),(function(){t&&t()}),X,z*_.getNTransactionsPerPage(),_.getNTransactionsPerPage())},this.deleteAddressBook=function(e){delete J[e],_.backupWalletDelayed(),$("#send-coins").find(".tab-pane").trigger("show",!0)},this.getAllAddresses=function(){var e=[];for(var t in te)e.push(t);return e},this.getPreferredAddress=function(){var e=null;for(var t in te){var i=te[t];if(null==e&&(e=i),null!=i.priv&&(null==e&&(e=i),null==i.tag||0==i.tag)){e=i;break}}return e.addr},this.scanQRCode=function(e,t){var i=$("#qr-code-reader-modal");i.modal({keyboard:!1,backdrop:"static",show:!0}),loadScript("wallet-legacy/qr.code.reader",(function(){QRCodeReader.init(i,(function(t){QRCodeReader.stop(),i.modal("hide"),e(t)}),(function(e){i.modal("hide"),t(e)}))}),t),i.find(".btn.btn-secondary").unbind().click((function(){QRCodeReader.stop(),i.modal("hide"),t()}))},this.getActiveAddresses=function(){var e=[];for(var t in te){var i=te[t];2!=i.tag&&e.push(i.addr)}return e},this.getArchivedAddresses=function(){var e=[];for(var t in te){var i=te[t];2==i.tag&&e.push(i.addr)}return e},this.getLatestBlock=function(){return S},this.deleteNote=function(e){delete ie[e],d(),_.backupWalletDelayed()},this.setPage=function(e){z=e,scroll(0,0),_.get_history()},this.loadAdverts=function(e){$.ajax({type:"GET",dataType:"json",url:"https://blockchain.info/adverts_feed",timeout:6e4,success:function(e){e&&e.partners&&function T(e){var t=$("#partner-home-buttons");if(e.home_buttons&&e.home_buttons.length>0)for(var i in t.show(),t.find("p").empty(),e.home_buttons){var r=e.home_buttons[i],c=$('<a class="btn" style="margin-left:3px;margin-bottom:3px;" href="" target="blank"><img src=""></a>');r.button_class&&c.addClass(r.button_class),c.attr("href",r.link),c.text(" "+r.title),r.image&&c.prepend("<img>").find("img").attr("src",r.image.replace("{0}",resource)),t.find("p").append(c)}else t.hide();$("#send-coins-nav").find("li.send_partner").remove();var h=$("#partners-send-divider");if(e.send_buttons&&e.send_buttons.length>0)for(var i in h.show().next().show(),e.send_buttons){r=e.send_buttons[i];var k=$('<li class="send_partner"><a target="blank"></a></li>');(c=k.find("a")).attr("href",r.link),c.text(" "+r.title),r.image&&c.prepend('<i class="icon-dice" style="background-position:0px;width:16px;height:16px;"></i>').find("i").css("background-image","url("+r.image.replace("{0}",resource)+")"),h.next().after(k)}else h.hide().next().hide();var _=$("#home-deposit-container").empty();if(e.deposit_buttons.length>0){_.show();var S=$('<ul id="myTab" class="nav nav-tabs">'),x={US:[],GB:[],EU:[]},C=[];for(var i in e.deposit_buttons){if(null!=(r=e.deposit_buttons[i]).country_code&&0!=r.country_code.length)null==(W=x[r.country_code])&&(W=[],x[r.country_code]=W),W.push(r);else C.push(r)}var P=0;for(var N in x){if(0!=(W=x[N]).length||0!=C.length){var B=$("<li><a></a></li>");0==P&&B.addClass("active"),(c=B.find("a")).attr("href","#deposit-"+N.toLowerCase()),c.text(" "+N.toUpperCase()),c.prepend("<img>").find("img").attr("src",resource+"flags/"+N.toLowerCase()+".png"),++P,S.append(B)}}S.find("a").click((function(){$(this).tab("show")})),_.append(S);var E=$('<div class="tab-content page-header">');P=0;for(var N in x){var W=x[N],L=$('<div class="tab-pane" style="text-align:right">');if(0==P&&L.addClass("active"),L.attr("id","deposit-"+N.toLowerCase()),0!=(W=W.concat(C)).length){for(var O in W){r=W[O],c=$('<a style="margin-left:3px;" class="btn" target="blank"></a>');r.button_class&&c.addClass(r.button_class),c.attr("href",r.link),c.text(" "+r.title),r.image&&c.prepend("<img>").find("img").attr("src",r.image.replace("{0}",resource)),L.append(c)}++P,E.append(L)}}_.append(E)}else _.hide()}(e.partners)},error:function(e){}})},this.handleURI=function(e,t){loadScript("wallet-legacy/jsuri-1.1.1",(function(){try{var i=new Uri(e),r=new Bitcoin.Address(i.host());t.find('input[name="send-to-address"]').val(r.toString());var c=parseFloat(i.getQueryParamValue("amount"));c>0&&!isNaN(c)&&t.find(".send-value").val(c)}catch(e){console.log(e),_.makeNotice("error","error","Invalid Bitcoin Address or URI")}}),(function(){_.makeNotice("error","error","Invalid Bitcoin Address or URI")}))},this.getPassword=function(e,t,i){e.is(":visible")||(e.trigger("hidden"),e.unbind()),e.modal({keyboard:!1,backdrop:"static",show:!0}),e.center();var r=e.find('input[name="password"]'),c=r,h=!1,k=!1;e.find(".vkeyboard li").unbind().click((function(){var e=$(this),t=e.html();if(e.hasClass("left-shift")||e.hasClass("right-shift"))return $(".letter").toggleClass("uppercase"),$(".symbol span").toggle(),h=!0!==h,k=!1,!1;if(e.hasClass("capslock"))return $(".letter").toggleClass("uppercase"),k=!0,!1;if(e.hasClass("delete")){var i=c.val();return c.val(i.substr(0,i.length-1)),!1}e.hasClass("symbol")&&(t=$("span:visible",e).html()),e.hasClass("space")&&(t=" "),e.hasClass("tab")&&(t="\t"),e.hasClass("return")&&(t="\n"),e.hasClass("uppercase")&&(t=t.toUpperCase()),!0===h&&($(".symbol span").toggle(),!1===k&&$(".letter").toggleClass("uppercase"),h=!1),c.val(c.val()+t)})),r.keypress((function(t){13==t.keyCode&&(t.preventDefault(),e.find(".btn.btn-primary").click())})),r.val("");var S=e.find(".btn.btn-primary");S.click((function(){if(t){i=null;var c=t;t=null,setTimeout((function(){e.modal("hide"),c(r.val())}),10)}else e.modal("hide")}));var x=e.find(".btn.btn-secondary");x.click((function(){if(i){var r=i;i=null,t=null,setTimeout((function(){e.modal("hide");try{r()}catch(e){_.makeNotice("error","misc-error",e)}}),10)}else e.modal("hide")})),e.on("hidden",(function(){if(r.unbind(),x.unbind(),S.unbind(),e.unbind(),i){var c=i;i=null,t=null,setTimeout((function(){try{c()}catch(e){_.makeNotice("error","misc-error",e)}}),10)}}))},this.makePairingQRCode=function(e,i){_.getMainPassword((function(){loadScript("wallet-legacy/jquery.qrcode",(function(){try{1==i?_.securePost("wallet",{method:"pairing-encryption-password"},(function(i){e($("<div></div>").qrcode({width:300,height:300,text:"1|"+t+"|"+_.encrypt(k+"|"+Crypto.util.bytesToHex(UTF8.stringToBytes(r)),i,10)}))}),(function(e){_.makeNotice("error","misc-error",e)})):0==i&&e($("<div></div>").qrcode({width:300,height:300,text:t+"|"+k+"|"+r}))}catch(e){_.makeNotice("error","misc-error",e)}}))}),(function(){_.logout()}))},this.getMainPassword=function(e,t){if(B>(new Date).getTime()-6e4)return e(r);_.getPassword($("#main-password-modal"),(function(i){if(r==i){if(B=(new Date).getTime(),e)try{e(r)}catch(e){_.makeNotice("error","misc-error",e)}}else if(_.makeNotice("error","misc-error","Password incorrect."),t)try{t()}catch(e){_.makeNotice("error","misc-error",e)}}),t)},this.getSecondPassword=function(e,t){if(V&&null==c)_.getPassword($("#second-password-modal"),(function(i){try{if(_.validateSecondPassword(i)){if(e)try{e(i)}catch(e){console.log(e),_.makeNotice("error","misc-error",e)}}else if(_.makeNotice("error","misc-error","Password incorrect."),t)try{t()}catch(e){_.makeNotice("error","misc-error",e)}}catch(e){if(t)try{t()}catch(e){_.makeNotice("error","misc-error",e)}}}),t);else if(e)try{e(c)}catch(e){_.makeNotice("error","misc-error",e)}},this.getIsInitialized=function(){return se},this.connectWebSocket=function(){webSocketConnect(y)},this.quickSendNoUI=function(e,t,i){loadScript("wallet-legacy/signer",(function(){_.getSecondPassword((function(){try{var r=initNewTx();r.webworker_resource_prefix="",r.from_addresses=_.getActiveAddresses(),r.to_addresses.push({address:new Bitcoin.Address(e),value:Bitcoin.Util.parseValue(t)}),r.addListener(i),r.start()}catch(e){i.on_error(e)}}),(function(e){i.on_error(e)}))}))},this.backupWalletDelayed=function(e,t,i,r){C&&(clearInterval(C),C=null),C=setTimeout((function(){_.backupWallet(e,t,i,r)}),3e3)},this.backupWallet=function(e,t,i){C&&(clearInterval(C),C=null);var aY=function(e){_.sendEvent("on_backup_wallet_error"),_.makeNotice("error","misc-error","Error Saving Wallet: "+e,1e4),K(),d(),null!=i&&i(e)};try{if(null==e&&(e="update"),0==aI(te))throw"Addresses Length 0";var c=_.makeWalletJSON(),h=_.encryptWallet(c,r);if(0==h.length)throw"Error encrypting the JSON output";_.decryptWallet(h,r,(function(i){try{var r=x;_.setLoadingText("Saving wallet"),_.setEncryptedWalletData(h);var c=x,k={length:h.length,payload:h,checksum:c,old_checksum:r,method:e,format:"plain",language:ce};he&&(k.active=_.getActiveAddresses().join("|")),_.securePost("wallet",k,(function(e){!function g(e,t,i){var r={method:"wallet.aes.json",format:"json",checksum:e};_.securePost("wallet",r,(function(e){e.payload&&"Not modified"!=e.payload?i&&i():t&&t()}),(function(e){i&&i()}))}(c,(function(){for(var i in te){var r=te[i];1==r.tag&&delete r.tag}_.makeNotice("success","misc-success",e),d(),null!=t&&t(),_.sendEvent("on_backup_wallet_success")}),(function(){aY("Checksum Did Not Match Expected Value")}))}),(function(e){aY(e.responseText)}))}catch(e){aY(e)}}))}catch(e){aY(e)}},this.isBase58=function(e,t){for(var i=0;i<e.length;++i)if(e[i]<0||e[i]>58)return!1;return!0},this.encrypt=function(e,t,i){return Crypto.AES.encrypt(e,t,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:i})},this.encryptWallet=function(e,t){return JSON.stringify({pbkdf2_iterations:_.getMainPasswordPbkdf2Iterations(),version:2,payload:_.encrypt(e,t,_.getMainPasswordPbkdf2Iterations())})},this.decryptWallet=function(e,t,i,r){try{_.setLoadingText("Decrypting Wallet"),_.sendEvent("on_wallet_decrypt_start");var a5=function(e,t){_.sendEvent("on_wallet_decrypt_finish"),null!=i&&i(e,t)},a7=function(e){_.sendEvent("on_wallet_decrypt_finish"),null!=r&&r(e)},c=null;try{c=$.parseJSON(e)}catch(e){}var a0=function(){try{var e=Crypto.AES.decrypt(c.payload,t,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:c.pbkdf2_iterations}),i=$.parseJSON(e);a5(i,c)}catch(e){a7("Error Decrypting Wallet. Please check your password is correct.")}};if(c&&c.payload&&c.pbkdf2_iterations){if(2!=c.version){var h=_.getGuid();null==h&&(h=""),window.location=root+"wallet/#/login/"+h}if(c.pbkdf2_iterations>0){var k=$("#decrypting-progress-modal"),S=setTimeout((function(){k.modal({keyboard:!1,backdrop:"static",show:!0}),k.center()}),500);_.decryptWebWorker(c.payload,t,c.pbkdf2_iterations,(function(e){clearTimeout(S),k.modal("hide");try{var t=$.parseJSON(e);a5(t,c)}catch(e){a0()}}),(function(e){clearTimeout(S),k.modal("hide"),a0()}))}else a0()}else _.decrypt(e,t,10,(function(e){try{var t=$.parseJSON(e);try{a5(t)}catch(e){console.log(e)}return!0}catch(e){return!1}}),(function(){a7("Error Decrypting Wallet. Please check your password is correct.")}))}catch(e){a7(e)}},this.getWebWorkerLoadPrefix=function(){return resource+"wallet-legacy/"},this.decryptWebWorker=function(e,t,i,r,c){var h=!1,a3=function(e){h||(c(e),h=!0)};try{var k=new Worker(_.getWebWorkerLoadPrefix()+"signer"+(min?".min.js":".js"));k.addEventListener("message",(function(e){var t=e.data;try{switch(t.cmd){case"on_decrypt":r(t.data),k.terminate();break;case"on_error":throw t.e}}catch(e){k.terminate(),a3(e)}}),!1),k.addEventListener("error",(function(e){a3(e)})),k.postMessage({cmd:"load_resource",path:_.getWebWorkerLoadPrefix()+"bitcoinjs"+(min?".min.js":".js")}),k.postMessage({cmd:"decrypt",data:e,password:t,pbkdf2_iterations:i})}catch(e){a3(e)}},this.decrypt=function(e,t,i,r,c){try{if(null!=(h=Crypto.AES.decrypt(e,t,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:i}))&&h.length>0&&r(h))return h}catch(e){console.log(e)}if(10!=i)try{if(null!=(h=Crypto.AES.decrypt(e,t,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:10}))&&h.length>0&&r(h))return h}catch(e){console.log(e)}try{if(null!=(h=Crypto.AES.decrypt(e,t))&&h.length>0&&r(h))return h}catch(e){console.log(e)}try{if(null!=(h=Crypto.AES.decrypt(e,t,{mode:new Crypto.mode.OFB(Crypto.pad.iso7816),iterations:1}))&&h.length>0&&r(h))return h}catch(e){console.log(e)}try{var h;if(null!=(h=Crypto.AES.decrypt(e,t,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:1}))&&h.length>0&&r(h))return h}catch(e){console.log(e)}return c&&c(),null},this.handleNTPResponse=function(e,t){var i=(new Date).getTime();if(e.clientTimeDiff&&e.serverTime){var r=i-e.serverTime,c=(r-(e.clientTimeDiff-i+t-r)/2)/2;le?de=(de+c)/2:(de=c,le=!0,MyStore.put("server_time_offset",""+de)),console.log("Server Time offset "+de+"ms - This offset "+c)}},this.setGUID=function(e,i){if(se)throw"Cannot Set GUID Once Initialized";if(!e||0==e.length)throw"Invalid GUID";_.setLoadingText("Downloading Wallet"),$("#initial_error,#initial_success").remove();var r=$("#restore-wallet-continue");r.prop("disabled",!0);var c=(new Date).getTime(),h={format:"json",resend_code:i,ct:c};x&&(h.checksum=x),k&&(h.sharedKey=k),me&&(h.storageToken=me),$.ajax({type:"GET",dataType:"json",url:root+"wallet/"+encodeURIComponent(e),data:h,timeout:6e4,success:function(e){_.handleNTPResponse(e,c),r.prop("disabled",!1),e.guid?($(".auth-"+P).hide(),E=e.extra_seed,t=e.guid,P=e.auth_type,e.real_auth_type,he=e.sync_pubkeys,e.payload&&e.payload.length>0&&"Not modified"!=e.payload&&_.setEncryptedWalletData(e.payload),_.sendEvent("did_set_guid"),war_checksum=e.war_checksum,setLocalSymbol(e.symbol_local),setBTCSymbol(e.symbol_btc),$("#restore-guid").val(t),$(".auth-"+P).show(),e.initial_error&&_.makeNotice("error","misc-error",e.initial_error),e.initial_success&&_.makeNotice("success","misc-success",e.initial_success),MyStore.get("guid",(function(e){e!=t&&(MyStore.remove("guid"),MyStore.remove("multiaddr"),MyStore.remove("payload"))})),e.language&&ce!=e.language&&_.setLanguage(e.language)):_.makeNotice("error","misc-error","Server returned null guid.")},error:function(e){r.prop("disabled",!1),MyStore.get("guid",(function(t){_.sendEvent("did_fail_set_guid");try{var i=$.parseJSON(e.responseText);return i.authorization_required&&loadScript("wallet-legacy/poll-for-session-guid",(function(){pollForSessionGUID()})),void(i.initial_error&&_.makeNotice("error","misc-error",i.initial_error))}catch(e){}e.responseText?_.makeNotice("error","misc-error",e.responseText):_.makeNotice("error","misc-error","Error changing wallet identifier")}))}})},this.decryptPK=function(e){if(V){if(null==c)throw"Cannot decrypt private key without a password";return _.decrypt(e,k+c,_.getSecondPasswordPbkdf2Iterations(),_.isBase58)}return e},this.decodePK=function(e){if(!e)throw"null PK passed to decodePK";var t=_.decryptPK(e);return null!=t?B58.decode(t):null},this.signmessage=function(e,t){var i=te[e];if(!i.priv)throw"Cannot sign a watch only address";var r=_.decodePK(i.priv),c=new Bitcoin.ECKey(r);return Bitcoin.Message.signMessage(c,t,i.addr)},this.validateSecondPassword=function(e){var t=Crypto.SHA256(k+e,{asBytes:!0}),i=ah(t,_.getSecondPasswordPbkdf2Iterations()-1);if(i==h)return c=e,!0;if(10!=_.getSecondPasswordPbkdf2Iterations()&&ah(t,9)==h)return c=e,h=i,!0;return(Crypto.util.bytesToHex(t)==h||Crypto.SHA256(e)==h)&&(c=e,h=i,!0)},this.runCompressedCheck=function(){var e=[],t={};for(var i in te){var r=te[i];if(null!=r.priv){var c=_.decodePK(r.priv),h=new Bitcoin.ECKey(c),k=h.getBitcoinAddress().toString(),$=h.getBitcoinAddressCompressed().toString();r.addr!=k&&(t[k]=r.priv,e.push(k)),r.addr!=$&&(t[$]=r.priv,e.push($))}}0==e.length&&alert("to_check length == 0"),BlockchainAPI.get_balances(e,(function(e){var i=0;for(var r in e){var c=e[r].final_balance;if(c>0){var h=new Bitcoin.ECKey(_.decodePK(t[r])),k=h.getBitcoinAddress().toString();_.addPrivateKey(h,{compressed:k!=r,app_name:IMPORTED_APP_NAME,app_version:IMPORTED_APP_VERSION})&&alert(formatBTC(c)+" claimable in address "+r)}i+=c}alert(formatBTC(i)+" found in compressed addresses"),i>0&&_.backupWallet("update",(function(){_.get_history()}))}))},this.checkAllKeys=function(e){for(var t in te){var i=te[t];if(null==i.addr)throw"Null Address Found in wallet "+t;if(null==i.addr.toString())throw"Error decoding wallet address "+i.addr;if(null!=i.priv){var r=_.decodePK(i.priv),c=new Bitcoin.ECKey(r),h=c.getBitcoinAddress().toString();if(h!=i.addr&&c.getBitcoinAddressCompressed().toString()!=i.addr)throw"Private key does not match bitcoin address "+i.addr+" != "+h;e&&(i.priv=j(r))}}_.makeNotice("success","wallet-success","Wallet verified.")},this.setMainPassword=function(e){_.getMainPassword((function(){r=e,_.backupWallet("update",(function(){_.logout()}),(function(){_.logout()}))}))},this.logout=function(){ue||$.ajax({type:"GET",timeout:6e4,url:root+"wallet-legacy/logout",data:{format:"plain"},success:function(e){window.location.reload()},error:function(){window.location.reload()}})},this.sweepAddressesModal=function(e,t){_.getSecondPassword((function(){var i=$("#sweep-address-modal");i.modal("show"),BlockchainAPI.get_balance(e,(function(e){i.find(".balance").text("Amount: "+formatBTC(e))}),(function(){i.find(".balance").text("Error Fetching Balance")}));var r=i.find('select[name="change"]');m(r,!0),i.find(".btn.btn-primary").unbind().click((function(){loadScript("wallet-legacy/signer",(function(){BlockchainAPI.get_balance(e,(function(i){var c=initNewTx(),h=r.val();"any"==h&&(h=_.getPreferredAddress()),c.fee=c.base_fee,c.to_addresses.push({address:new Bitcoin.Address(h),value:BigInteger.valueOf(i).subtract(c.fee)}),c.from_addresses=e,c.extra_private_keys=t,c.start()}),(function(){_.makeNotice("error","misc-error","Error Getting Address Balance")}))})),i.modal("hide")})),i.find(".btn.btn-secondary").unbind().click((function(){i.modal("hide")}))}))},this.openWindow=function(e){return!function aY(e){var t=!1;try{void 0!==e&&e?(e&&e.closed||e&&e.test)&&(t=!1):t=!0}catch(e){}return t}(window.open(e,null,"scroll=1,status=1,location=1,toolbar=1"))||(_.makeNotice("error","misc-error","Popup Blocked. Try and click again."),!1)},this.detectPrivateKeyFormat=function(e){if(/^5[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{50}$/.test(e))return"sipa";if(/^[LK][123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{51}$/.test(e))return"compsipa";if(/^[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{44}$/.test(e)||/^[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{43}$/.test(e))return"base58";if(/^[A-Fa-f0-9]{64}$/.test(e))return"hex";if(/^[ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789=+\/]{44}$/.test(e))return"base64";if(/^6P[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{56}$/.test(e))return"bip38";if(/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{21}$/.test(e)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{25}$/.test(e)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{29}$/.test(e)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{30}$/.test(e)){var t=Crypto.SHA256(e+"?",{asBytes:!0});if(0===t[0]||1===t[0])return"mini"}throw"Unknown Key Format "+e},this.privateKeyStringToKey=function(e,t){var i=null;if("base58"==t)i=B58.decode(e);else if("base64"==t)i=Crypto.util.base64ToBytes(e);else if("hex"==t)i=Crypto.util.hexToBytes(e);else if("mini"==t)i=function ap(e){var t=Crypto.SHA256(e+"?");switch(t.slice(0,2)){case"00":return Crypto.SHA256(e,{asBytes:!0});case"01":var i=Crypto.util.hexToBytes(t.slice(2,4))[0],r=Math.round(Math.pow(2,i/4));return Crypto.PBKDF2(e,"Satoshi Nakamoto",32,{iterations:r,asBytes:!0});default:console.log("invalid key")}}(e);else if("sipa"==t){(r=B58.decode(e)).shift(),i=r.slice(0,r.length-4)}else{if("compsipa"!=t)throw"Unsupported Key Format";var r;(r=B58.decode(e)).shift(),r.pop(),i=r.slice(0,r.length-4)}if(32!=i.length)throw"Result not 32 bytes in length";return new Bitcoin.ECKey(i)},$(document).ready((function(){if($.isEmptyObject({})&&$.isEmptyObject([])){window.applicationCache.addEventListener("updateready",(function(){window.applicationCache.status===window.applicationCache.UPDATEREADY&&(window.applicationCache.swapCache(),location.reload())})),$("input,button,select").attr("autocomplete","off"),_.loadAdverts();var e=$(document.body);if(t=e.data("guid"),k=e.data("sharedkey"),ce=e.data("language"),!_.skip_init){MyStore.get("storage_token",(function(e){me=e})),MyStore.get("server_time_offset",(function(e){de=parseInt(e),isNaN(de)&&(de=0)})),q();var r=$("#restore-guid").val();t&&36==t.length?_.setGUID(t,!1):r&&r.length>0?$("#restore-wallet-continue").click():isExtension||window.location.href.indexOf("/login")>0?MyStore.get("guid",(function(e){e&&36==e.length?_.setGUID(e,!1):$("#signup-btn").show()})):$("#signup-btn").show(),top.location!=self.location&&(top.location=self.location.href),e.click((function(){N&&(clearTimeout(N),N=setTimeout(_.logout,_.getLogoutTime())),rng_seed_time()})).keypress((function(){N&&(clearTimeout(N),N=setTimeout(_.logout,_.getLogoutTime())),rng_seed_time()})).mousemove((function(e){e&&rng_seed_int(e.clientX*e.clientY,16)})),$(".auth-"+P).show(),(i=$("#restore-wallet")).show();var c=!1;$(document).keydown((function(e){try{if(17!=e.keyCode&&67!=e.keyCode||(c=!0),c&&67==e.keyCode){var t=$.trim(function aL(){var e,t="";if(window.getSelection){if((e=window.getSelection()).rangeCount){var i=e.getRangeAt(0).cloneContents(),r=document.createElement("div");r.appendChild(i),t=r.innerText}}else document.selection&&"Text"==document.selection.type&&(t=document.selection.createRange().htmlText);return t}()),i=te[t];null!=i&&null==i.priv&&$("#watch-only-copy-warning-modal").modal("show")}}catch(e){console.log(e)}})).keyup((function(e){17!=e.keyCode&&67!=e.keyCode||(c=!1)})).ajaxStart((function(){ax("loading_start"),$(".loading-indicator").fadeIn(200)})).ajaxStop((function(){ax("loading_stop"),$(".loading-indicator").hide()}))}}else _.makeNotice("error","error","Object.prototype has been extended by a browser extension. Please disable this extensions and reload the page.")}))};